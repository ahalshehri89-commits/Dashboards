<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„ÙˆØ­Ø© Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¶Ù†Ùƒ - ÙˆÙ‚Ø§ÙŠØ©</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-chart-treemap"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Sakkal Majalla', 'Traditional Arabic', 'Arabic Typesetting', Arial, sans-serif;
            background: linear-gradient(to bottom right, #f3f4f6, #e5e7eb);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            border: 1px solid rgba(12, 197, 156, 0.2);
            box-shadow: 8px 8px 16px #b8d4d2, -8px -8px 16px #ffffff;
            transition: all 0.3s ease;
        }

        .glass-card:hover {
            transform: translateY(-2px);
            box-shadow: 10px 10px 20px #b8d4d2, -10px -10px 20px #ffffff;
        }

        .header-bar {
            background: linear-gradient(to right, #0cc59c, #0c9ca5);
            backdrop-filter: blur(10px);
            border-bottom: 2px solid rgba(10, 124, 107, 0.3);
            box-shadow: 0 4px 20px rgba(12, 197, 156, 0.2);
        }

        .nav-btn {
            background: transparent;
            border: 1px solid rgba(12, 197, 156, 0.3);
            color: #0a7c6b;
            padding: 10px 18px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .nav-btn:hover {
            background: linear-gradient(to right, #0cc59c, #0c9ca5);
            border-color: #0c9ca5;
            color: white;
            transform: translateY(-2px);
        }

        .sidebar {
            background: rgba(243, 244, 246, 0.98);
            backdrop-filter: blur(10px);
            min-height: calc(100vh - 80px);
            padding: 25px;
            border-left: 2px solid rgba(12, 197, 156, 0.3);
        }

        .filter-group {
            margin-bottom: 24px;
        }

        .filter-label {
            color: #0a7c6b;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 10px;
            display: block;
        }

        .filter-select {
            width: 100%;
            padding: 12px;
            background: rgba(255, 255, 255, 0.8);
            border: 1px solid rgba(12, 197, 156, 0.3);
            border-radius: 8px;
            color: #0a7c6b;
            font-family: 'Sakkal Majalla', 'Traditional Arabic', 'Arabic Typesetting', Arial, sans-serif;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .filter-select:hover,
        .filter-select:focus {
            background: rgba(255, 255, 255, 1);
            border-color: #0c9ca5;
            outline: none;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px;
            margin: 8px 0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .checkbox-item:hover {
            background: rgba(12, 197, 156, 0.1);
        }

        .checkbox-item label {
            color: #0a7c6b;
            font-size: 13px;
            cursor: pointer;
            flex: 1;
            text-align: right;
        }

        .checkbox-item input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
            margin-left: 10px;
            accent-color: #0cc59c;
        }

        .search-btn {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #0c9ca5 0%, #0cc59c 100%);
            border: none;
            border-radius: 10px;
            color: white;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(12, 156, 165, 0.3);
        }

        .search-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(12, 156, 165, 0.5);
        }

        .card-title {
            color: #0a7c6b;
            font-size: 15px;
            font-weight: 700;
            margin-bottom: 20px;
            text-align: center;
            padding-bottom: 12px;
            border-bottom: 2px solid rgba(12, 197, 156, 0.3);
        }

        .map-container {
            position: relative;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: visible;
        }

        .map-dot {
            position: absolute;
            width: 2.5px;
            height: 2.5px;
            background: rgba(12, 197, 156, 0.35);
            border-radius: 50%;
            animation: pulse 3s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 0.6; }
        }

        .map-marker {
            position: absolute;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            box-shadow: 0 0 20px currentColor;
            cursor: pointer;
            transition: all 0.3s ease;
            animation: markerPulse 2s infinite;
            z-index: 10;
        }

        @keyframes markerPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .map-marker:hover {
            transform: scale(1.4) !important;
            z-index: 20;
        }

        .city-legend-container {
            position: absolute;
            right: -200px;
            top: 0;
            display: flex;
            flex-direction: column;
            gap: 8px;
            z-index: 15;
            width: 180px;
            max-height: 350px;
            overflow-y: auto;
            overflow-x: hidden;
            padding-right: 5px;
        }
        
        .city-legend-container::-webkit-scrollbar {
            width: 6px;
        }
        
        .city-legend-container::-webkit-scrollbar-track {
            background: rgba(184, 212, 210, 0.2);
            border-radius: 3px;
        }
        
        .city-legend-container::-webkit-scrollbar-thumb {
            background: rgba(12, 197, 156, 0.5);
            border-radius: 3px;
        }
        
        .city-legend-container::-webkit-scrollbar-thumb:hover {
            background: rgba(12, 197, 156, 0.7);
        }

        .city-legend-item {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(12, 197, 156, 0.4);
            border-radius: 8px;
            padding: 10px 12px;
            box-shadow: 4px 4px 8px #b8d4d2, -4px -4px 8px #ffffff;
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            animation: fadeInLabel 0.5s ease backwards;
        }

        .city-legend-item:hover {
            transform: translateX(-5px);
            border-color: rgba(12, 197, 156, 0.8);
            box-shadow: 6px 6px 12px #b8d4d2, -6px -6px 12px #ffffff;
        }

        @keyframes fadeInLabel {
            from { opacity: 0; transform: translateX(20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .city-legend-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            flex-shrink: 0;
            box-shadow: 0 0 10px currentColor;
        }

        .city-legend-info {
            flex: 1;
        }

        .city-legend-name {
            color: #0a7c6b;
            font-size: 13px;
            font-weight: 700;
            margin-bottom: 2px;
            text-align: right;
            white-space: nowrap;
        }

        .city-legend-cases {
            color: #0c9ca5;
            font-size: 11px;
            font-weight: 600;
            text-align: right;
        }

        .stat-box {
            text-align: center;
            padding: 15px;
        }

        .stat-value {
            font-size: 36px;
            font-weight: 700;
            color: #0a7c6b;
            text-shadow: 0 2px 10px rgba(12, 197, 156, 0.2);
            transition: all 0.3s ease;
        }

        .stat-value:hover {
            transform: scale(1.1);
        }

        .stat-label {
            font-size: 12px;
            color: rgba(10, 124, 107, 0.8);
            margin-top: 5px;
        }

        .percentage-display {
            font-size: 32px;
            font-weight: 700;
            color: #0a7c6b;
            text-align: center;
            margin: 15px 0;
        }

        .icon-circle {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: rgba(12, 197, 156, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            margin: 0 auto 10px;
        }

        .progress-bar-container {
            width: 100%;
            height: 30px;
            background: rgba(184, 212, 210, 0.3);
            border-radius: 15px;
            overflow: hidden;
            margin: 8px 0;
            position: relative;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #0cc59c 0%, #0c9ca5 100%);
            border-radius: 15px;
            transition: width 1s ease;
            display: flex;
            align-items: center;
            justify-content: flex-start;
            padding-left: 10px;
            color: white;
            font-size: 11px;
            font-weight: 600;
        }

        .legend-item {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin: 8px 0;
        }

        .legend-box {
            width: 16px;
            height: 16px;
            border-radius: 4px;
        }

        .legend-text {
            color: #0a7c6b;
            font-size: 12px;
        }

        .tooltip {
            position: absolute;
            background: rgba(10, 124, 107, 0.95);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 1000;
        }

        .logo-img {
            height: 60px;
            width: auto;
            object-fit: contain;
            filter: brightness(1.05) drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1));
            background: rgba(255, 255, 255, 0.9);
            padding: 10px 15px;
            border-radius: 8px;
            border: 1px solid rgba(12, 197, 156, 0.2);
        }

        /* Responsive adjustments */
        @media (max-width: 1024px) {
            .nav-btn {
                padding: 8px 12px;
                font-size: 11px;
            }
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(184, 212, 210, 0.2);
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(12, 197, 156, 0.5);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(12, 197, 156, 0.7);
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header-bar" style="padding: 15px 30px;">
        <!-- Top Row: Logo and Title -->
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
            <!-- Left section - Logo only -->
            <div style="display: flex; align-items: center;">
                <img src="./dashboard-images/pha-logo.png" alt="PHA" class="logo-img" onerror="this.style.display='none'">
            </div>

            <!-- Center title -->
            <div style="flex: 1; text-align: center;">
                <h1 style="color: white; font-size: 22px; font-weight: 700; text-shadow: 0 2px 10px rgba(12, 197, 156, 0.3);">
                    Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ù…Ù†ØµØ© Ø§Ù„ØµØ­Ø© Ø§Ù„ÙˆØ§Ø­Ø¯Ø©
                </h1>
            </div>

            <!-- Right section - Empty for balance -->
            <div style="display: flex; align-items: center; width: 55px;">
                <!-- Empty space for visual balance -->
            </div>
        </div>

        <!-- Bottom Row: Filters -->
        <div style="display: flex; justify-content: center; align-items: center; gap: 15px; flex-wrap: wrap; padding-top: 15px; border-top: 1px solid rgba(255, 255, 255, 0.3);">
            <!-- City Filter -->
            <div style="display: flex; align-items: center; gap: 8px;">
                <label style="color: white; font-size: 13px; font-weight: 600;">Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©:</label>
                <select class="filter-select" id="citySelect" onchange="updateDashboard()" style="width: 120px; padding: 8px 12px; font-size: 13px;">
                    <option value="all">Ø§Ù„ÙƒÙ„</option>
                    <option value="riyadh">Ø§Ù„Ø±ÙŠØ§Ø¶</option>
                    <option value="jeddah">Ø¬Ø¯Ø©</option>
                    <option value="makkah">Ù…ÙƒØ© Ø§Ù„Ù…ÙƒØ±Ù…Ø©</option>
                    <option value="madinah">Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ù…Ù†ÙˆØ±Ø©</option>
                    <option value="dammam">Ø§Ù„Ø¯Ù…Ø§Ù…</option>
                    <option value="khobar">Ø§Ù„Ø®Ø¨Ø±</option>
                    <option value="taif">Ø§Ù„Ø·Ø§Ø¦Ù</option>
                    <option value="tabuk">ØªØ¨ÙˆÙƒ</option>
                    <option value="buraydah">Ø¨Ø±ÙŠØ¯Ø©</option>
                    <option value="hail">Ø­Ø§Ø¦Ù„</option>
                    <option value="abha">Ø£Ø¨Ù‡Ø§</option>
                    <option value="najran">Ù†Ø¬Ø±Ø§Ù†</option>
                    <option value="jazan">Ø¬Ø§Ø²Ø§Ù†</option>
                </select>
            </div>

            <!-- Year Filter -->
            <div style="display: flex; align-items: center; gap: 8px;">
                <label style="color: white; font-size: 13px; font-weight: 600;">Ø§Ù„Ø³Ù†Ø©:</label>
                <select class="filter-select" id="yearSelect" onchange="updateDashboard()" style="width: 100px; padding: 8px 12px; font-size: 13px;">
                    <option>2018</option>
                    <option selected>2019</option>
                    <option>2020</option>
                    <option>2021</option>
                    <option>2022</option>
                    <option>2023</option>
                    <option>2024</option>
                    <option>2025</option>
                </select>
            </div>

            <!-- Week Filter -->
            <div style="display: flex; align-items: center; gap: 8px;">
                <label style="color: white; font-size: 13px; font-weight: 600;">Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„ÙˆØ¨Ø§Ø¦ÙŠ:</label>
                <select class="filter-select" id="weekSelect" onchange="updateDashboard()" style="width: 100px; padding: 8px 12px; font-size: 13px;">
                    <option value="all">Ø§Ù„ÙƒÙ„</option>
                    <option>1</option>
                    <option>2</option>
                    <option>3</option>
                    <option>4</option>
                    <option>5</option>
                    <option>6</option>
                    <option>7</option>
                    <option>8</option>
                    <option>9</option>
                    <option>10</option>
                    <option>11</option>
                    <option>12</option>
                    <option>13</option>
                    <option>14</option>
                    <option>15</option>
                    <option>16</option>
                    <option>17</option>
                    <option>18</option>
                    <option>19</option>
                    <option>20</option>
                    <option>21</option>
                    <option>22</option>
                    <option>23</option>
                    <option>24</option>
                    <option>25</option>
                    <option>26</option>
                    <option>27</option>
                    <option>28</option>
                    <option>29</option>
                    <option>30</option>
                    <option>31</option>
                    <option>32</option>
                    <option>33</option>
                    <option>34</option>
                    <option>35</option>
                    <option>36</option>
                    <option>37</option>
                    <option>38</option>
                    <option>39</option>
                    <option>40</option>
                    <option>41</option>
                    <option>42</option>
                    <option>43</option>
                    <option>44</option>
                    <option>45</option>
                    <option>46</option>
                    <option>47</option>
                    <option>48</option>
                    <option>49</option>
                    <option>50</option>
                    <option>51</option>
                    <option>52</option>
                </select>
            </div>

            <!-- Case Type Filter -->
            <div style="display: flex; align-items: center; gap: 8px;">
                <label style="color: white; font-size: 13px; font-weight: 600;">ØªØµÙ†ÙŠÙ Ø§Ù„Ø­Ø§Ù„Ø©:</label>
                <select class="filter-select" id="caseTypeSelect" onchange="updateDashboard()" style="width: 120px; padding: 8px 12px; font-size: 13px;">
                    <option value="all">Ø§Ù„ÙƒÙ„</option>
                    <option value="suspected">Ù…Ø´ØªØ¨Ù‡Ø©</option>
                    <option value="confirmed">Ù…Ø¤ÙƒØ¯Ø©</option>
                </select>
            </div>

            <!-- Case Outcome Filter -->
            <div style="display: flex; align-items: center; gap: 8px;">
                <label style="color: white; font-size: 13px; font-weight: 600;">Ø§Ù„Ù†ØªÙŠØ¬Ø© Ù„Ù„Ø­Ø§Ù„Ø©:</label>
                <select class="filter-select" id="outcomeSelect" onchange="updateDashboard()" style="width: 150px; padding: 8px 12px; font-size: 13px;">
                    <option value="all">Ø§Ù„ÙƒÙ„</option>
                    <option value="infected">Ù…ØµØ§Ø¨</option>
                    <option value="critical">Ø­Ø§Ù„Ø© Ø®Ø·Ø±Ø©</option>
                    <option value="icu">Ù†Ù‚Ù„ Ù„Ù„Ø¹Ù†Ø§ÙŠØ© Ø§Ù„Ù…Ø±ÙƒØ²Ø©</option>
                    <option value="death">ØªÙˆÙÙŠ</option>
                    <option value="recovered">ØªØ¹Ø§ÙÙ‰</option>
                </select>
            </div>

            <!-- Gender Filter -->
            <div style="display: flex; align-items: center; gap: 8px;">
                <label style="color: white; font-size: 13px; font-weight: 600;">Ø§Ù„Ø¬Ù†Ø³:</label>
                <select class="filter-select" id="genderSelect" onchange="updateDashboard()" style="width: 100px; padding: 8px 12px; font-size: 13px;">
                    <option value="all">Ø§Ù„ÙƒÙ„</option>
                    <option value="male">Ø°ÙƒØ±</option>
                    <option value="female">Ø£Ù†Ø«Ù‰</option>
                </select>
            </div>

            <!-- Nationality Filter -->
            <div style="display: flex; align-items: center; gap: 8px;">
                <label style="color: white; font-size: 13px; font-weight: 600;">Ø§Ù„Ø¬Ù†Ø³ÙŠØ©:</label>
                <select class="filter-select" id="nationalitySelect" onchange="updateDashboard()" style="width: 120px; padding: 8px 12px; font-size: 13px;">
                    <option value="all">Ø§Ù„ÙƒÙ„</option>
                    <option value="saudi">Ø³Ø¹ÙˆØ¯ÙŠ</option>
                    <option value="egyptian">Ù…ØµØ±ÙŠ</option>
                    <option value="syrian">Ø³ÙˆØ±ÙŠ</option>
                    <option value="yemeni">ÙŠÙ…Ù†ÙŠ</option>
                    <option value="jordanian">Ø£Ø±Ø¯Ù†ÙŠ</option>
                    <option value="palestinian">ÙÙ„Ø³Ø·ÙŠÙ†ÙŠ</option>
                    <option value="lebanese">Ù„Ø¨Ù†Ø§Ù†ÙŠ</option>
                    <option value="sudanese">Ø³ÙˆØ¯Ø§Ù†ÙŠ</option>
                    <option value="pakistani">Ø¨Ø§ÙƒØ³ØªØ§Ù†ÙŠ</option>
                    <option value="indian">Ù‡Ù†Ø¯ÙŠ</option>
                    <option value="bangladeshi">Ø¨Ù†ØºÙ„Ø§Ø¯ÙŠØ´ÙŠ</option>
                    <option value="filipino">ÙÙ„Ø¨ÙŠÙ†ÙŠ</option>
                    <option value="indonesian">Ø¥Ù†Ø¯ÙˆÙ†ÙŠØ³ÙŠ</option>
                    <option value="ethiopian">Ø¥Ø«ÙŠÙˆØ¨ÙŠ</option>
                    <option value="eritrean">Ø¥Ø±ÙŠØªØ±ÙŠ</option>
                    <option value="other">Ø£Ø®Ø±Ù‰</option>
                </select>
            </div>

            <!-- Age Group Filter -->
            <div style="display: flex; align-items: center; gap: 8px;">
                <label style="color: white; font-size: 13px; font-weight: 600;">Ø§Ù„ÙØ¦Ø© Ø§Ù„Ø¹Ù…Ø±ÙŠØ©:</label>
                <select class="filter-select" id="ageGroupSelect" onchange="updateDashboard()" style="width: 110px; padding: 8px 12px; font-size: 13px;">
                    <option value="all">Ø§Ù„ÙƒÙ„</option>
                    <option value="1-5">1-5</option>
                    <option value="6-10">6-10</option>
                    <option value="11-15">11-15</option>
                    <option value="16-20">16-20</option>
                    <option value="21-25">21-25</option>
                    <option value="26-30">26-30</option>
                    <option value="31-35">31-35</option>
                    <option value="36-40">36-40</option>
                    <option value="41-45">41-45</option>
                    <option value="46-50">46-50</option>
                    <option value="51-55">51-55</option>
                    <option value="56-60">56-60</option>
                    <option value="61-65">61-65</option>
                    <option value="66-70">66-70</option>
                    <option value="71+">71+</option>
                </select>
            </div>

            <!-- Ministry Filter -->
            <div style="display: flex; align-items: center; gap: 8px;">
                <label style="color: white; font-size: 13px; font-weight: 600;">Ø§Ù„Ø¬Ù‡Ø©:</label>
                <select class="filter-select" id="ministrySelect" onchange="updateDashboard()" style="width: 180px; padding: 8px 12px; font-size: 13px;">
                    <option value="all">Ø§Ù„ÙƒÙ„</option>
                    <option value="moh" selected>ÙˆØ²Ø§Ø±Ø© Ø§Ù„ØµØ­Ø©</option>
                    <option value="momra">ÙˆØ²Ø§Ø±Ø© Ø§Ù„Ø¨Ù„Ø¯ÙŠØ§Øª ÙˆØ§Ù„Ø¥Ø³ÙƒØ§Ù†</option>
                    <option value="env">ÙˆÙ‚Ø§Ø¡</option>
                </select>
            </div>

            <!-- Search Button -->
            <button class="search-btn" onclick="applyFilters()" style="width: auto; padding: 8px 24px; font-size: 14px;">
                Ø¨Ø­Ø«
            </button>
        </div>
    </div>

    <div style="display: flex;">
        <!-- Main Content -->
        <div style="flex: 1; padding: 25px;">
            <!-- Top Row: Epicurve Chart (Full Width) -->
            <div style="margin-bottom: 20px;">
                <div class="glass-card" style="padding: 20px;">
                    <h3 class="card-title">Ø§Ù„Ù†Ø´Ø§Ø· Ø§Ù„ÙˆØ¨Ø§Ø¦ÙŠ Ù„Ù„Ø­Ø§Ù„Ø§Øª   </h3>
                    <div style="height: 280px;">
                        <canvas id="activityChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Second Row: Map and Bar Chart -->
            <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 20px; margin-bottom: 20px;">
                <!-- Map Container with Legends (2/3 width) -->
                <div class="glass-card" style="padding: 20px;">
                    <!-- Map Square with Legends -->
                    <div class="map-container" id="mapContainer" style="height: 500px; width: 100%; position: relative;">
                        <!-- Map dots and markers will be generated by JavaScript -->

                        <!-- Legends Container (positioned in corner) -->
                        <div id="mapLegendsContainer" style="position: absolute; top: 10px; left: 10px; display: flex; flex-direction: column; gap: 8px; z-index: 10; max-width: 140px;">
                            <!-- Legends will be inserted here by JavaScript -->
                        </div>
                    </div>
                </div>
                
                <!-- Horizontal Bar Chart (1/3 width) -->
                <div class="glass-card" style="padding: 20px;">
                    <h3 class="card-title">Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø­Ø³Ø¨ Ø§Ù„ÙØ¦Ø§Øª Ø§Ù„Ø¹Ù…Ø±ÙŠØ©</h3>
                    <div style="height: 500px;">
                        <canvas id="topRegionsChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Third Row: Pie Charts and Bar Chart -->
            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 20px;">
                <!-- Suspected vs Confirmed -->
                <div class="glass-card" style="padding: 20px;">
                    <h3 class="card-title" id="suspectedChartTitle">ØªØµÙ†ÙŠÙ Ø§Ù„Ø­Ø§Ù„Ø©</h3>
                    <div style="height: 200px; display: flex; justify-content: center; align-items: center;">
                        <canvas id="suspectedChart" style="max-height: 180px;"></canvas>
                    </div>
                    <div style="display: flex; justify-content: space-around; margin-top: 15px;">
                        <div class="legend-item">
                            <span class="legend-text">Ø§Ù„Ù…Ø´ØªØ¨Ù‡Ø©</span>
                            <div class="legend-box" style="background: #0cc59c;"></div>
                        </div>
                        <div class="legend-item">
                            <span class="legend-text">Ø§Ù„Ù…Ø¤ÙƒØ¯</span>
                            <div class="legend-box" style="background: #0c9ca5;"></div>
                        </div>
                    </div>
                </div>

                <!-- Additional Info -->
                <div class="glass-card" style="padding: 20px;">
                    <h3 class="card-title">Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø³Ø±ÙŠØ±ÙŠØ© Ù„Ù„Ø­Ø§Ù„Ø§Øª</h3>
                    <div style="padding: 10px;">
                        <!-- Row 1: Total Cases (full width) -->
                        <div style="margin: 12px 0; text-align: center;">
                            <div style="background: rgba(12, 197, 156, 0.1); border-radius: 12px; padding: 15px 20px; display: inline-block; box-shadow: 0 4px 15px rgba(12, 197, 156, 0.15);">
                                <div class="stat-value" style="font-size: 28px;" id="totalCases">2,645</div>
                                <div class="stat-label">Ø§Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø­Ø§Ù„Ø§Øª</div>
                            </div>
                        </div>
                        
                        <!-- Row 2: Recovered and Deaths (side by side) -->
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin: 12px 0;">
                            <div style="text-align: center;">
                                <div style="background: rgba(78, 205, 196, 0.1); border-radius: 12px; padding: 15px 10px; box-shadow: 0 4px 15px rgba(78, 205, 196, 0.15);">
                                    <div class="stat-value" style="font-size: 24px; color: #4ecdc4;" id="recoveredCases">2,423</div>
                                    <div class="stat-label">Ù…ØªØ¹Ø§ÙÙŠ</div>
                                </div>
                            </div>
                            <div style="text-align: center;">
                                <div style="background: rgba(243, 129, 129, 0.1); border-radius: 12px; padding: 15px 10px; box-shadow: 0 4px 15px rgba(243, 129, 129, 0.15);">
                                    <div class="stat-value" style="font-size: 24px; color: #f38181;" id="deathCases">55</div>
                                    <div class="stat-label">Ù…ØªÙˆÙÙŠ</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Row 3: Hospitalized (Ward and ICU side by side) -->
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin: 12px 0;">
                            <div style="text-align: center;">
                                <div style="background: rgba(12, 156, 165, 0.1); border-radius: 12px; padding: 15px 10px; box-shadow: 0 4px 15px rgba(12, 156, 165, 0.15);">
                                    <div class="stat-value" style="font-size: 24px; color: #0c9ca5;" id="wardCases">98</div>
                                    <div class="stat-label">Ù…Ù†ÙˆÙ… </div>
                                </div>
                            </div>
                            <div style="text-align: center;">
                                <div style="background: rgba(10, 124, 107, 0.1); border-radius: 12px; padding: 15px 10px; box-shadow: 0 4px 15px rgba(10, 124, 107, 0.15);">
                                    <div class="stat-value" style="font-size: 24px; color: #0a7c6b;" id="icuCases">34</div>
                                    <div class="stat-label">Ù…Ù†ÙˆÙ… Ø¨Ø§Ù„Ø¹Ù†Ø§ÙŠØ© </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Gender Stats -->
                <div class="glass-card" style="padding: 20px;">
                    <h3 class="card-title">Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ø¬Ù†Ø³</h3>
                    <div style="display: flex; justify-content: space-around; padding: 20px 0;">
                        <div style="text-align: center;">
                            <div style="background: rgba(12, 197, 156, 0.1); border-radius: 12px; padding: 20px 25px; box-shadow: 0 4px 15px rgba(12, 197, 156, 0.15);">
                                <div class="icon-circle" style="color: #0cc59c;">â™‚</div>
                                <div class="percentage-display" id="malePercent" style="color: #0cc59c;">50%</div>
                                <div class="percentage-display" id="maleCases" style="color: #0cc59c;">1,200</div>
                            </div>
                        </div>
                        <div style="text-align: center;">
                            <div style="background: rgba(12, 156, 165, 0.1); border-radius: 12px; padding: 20px 25px; box-shadow: 0 4px 15px rgba(12, 156, 165, 0.15);">
                                <div class="icon-circle" style="color: #0c9ca5;">â™€</div>
                                <div class="percentage-display" id="femalePercent" style="color: #0c9ca5;">60%</div>
                                <div class="percentage-display" id="femaleCases" style="color: #0c9ca5;">1,445</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Third Row: Stats Cards -->
            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 20px;">
                <!-- Indigenous vs Imported -->
                <div class="glass-card" style="padding: 20px;">
                    <h3 class="card-title">Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ø¬Ù†Ø³ÙŠØ©</h3>
                    <div style="display: flex; justify-content: space-around; padding: 20px 0;">
                        <div style="text-align: center;">
                            <div style="background: rgba(12, 156, 165, 0.1); border-radius: 12px; padding: 20px 25px; box-shadow: 0 4px 15px rgba(12, 156, 165, 0.15);">
                                <div style="font-size: 50px; margin: 0 auto 10px;">ğŸŒ</div>
                                <div class="percentage-display" id="worldPercent">50%</div>
                                <div class="percentage-display" id="worldCases">1,200</div>
                            </div>
                        </div>
                        <div style="text-align: center;">
                            <div style="background: rgba(12, 197, 156, 0.1); border-radius: 12px; padding: 20px 25px; box-shadow: 0 4px 15px rgba(12, 197, 156, 0.15);">
                                <div style="font-size: 50px; margin: 0 auto 10px;">ğŸ‡¸ğŸ‡¦</div>
                                <div class="percentage-display" id="saudiPercent">50%</div>
                                <div class="percentage-display" id="saudiCases">1,445</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Non-Saudi Nationalities -->
                <div class="glass-card" style="padding: 20px;">
                    <h3 class="card-title">Ø§Ù„Ø¬Ù†Ø³ÙŠØ§Øª ØºÙŠØ± Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©</h3>
                    <div style="height: 200px;">
                        <canvas id="diagnosisChart"></canvas>
                    </div>
                </div>

                <!-- Occupations -->
                <div class="glass-card" style="padding: 20px;">
                    <h3 class="card-title">Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ù…Ù‡Ù†Ø©</h3>
                    <div style="height: 200px;">
                        <canvas id="ministryChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- New Row: Most Reporting Hospitals -->
            <div style="margin-bottom: 20px;">
                <div class="glass-card" style="padding: 20px;">
                    <h3 class="card-title">Ø§Ù„Ù…Ù†Ø´Ø¢Øª Ø§Ù„ØµØ­ÙŠØ© Ø§Ù„Ø£Ø¹Ù„Ù‰ ØªØ¨Ù„ÙŠØºØ§Ù‹</h3>
                    <div style="height: 300px;">
                        <canvas id="occupationStackedChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Lab Result Status -->
            <div style="margin-bottom: 20px;">
                <div class="glass-card" style="padding: 20px;">
                    <h3 class="card-title">Ø­Ø§Ù„Ø© Ø§Ù„ÙØ­ÙˆØµØ§Øª Ø§Ù„Ù…Ø®Ø¨Ø±ÙŠØ©</h3>
                    <div style="height: 300px;">
                        <canvas id="occupationStackedChart2"></canvas>
                    </div>
                </div>
            </div>

            <!-- Pending Lab Results -->
            <div style="margin-bottom: 20px;">
                <div class="glass-card" style="padding: 20px;">
                    <h3 class="card-title">Ø­Ø§Ù„Ø© Ø§Ù„ÙØ­ÙˆØµØ§Øª Ø§Ù„Ù…Ø®Ø¨Ø±ÙŠØ© Ø§Ù„Ù…Ø¹Ù„Ù‚Ø© Ù„Ø­Ù…Ù‰ Ø§Ù„Ø¶Ù†Ùƒ</h3>
                    <div style="height: 300px;">
                        <canvas id="occupationStackedChart3"></canvas>
                    </div>
                </div>
            </div>

            <!-- TreeMap Labs -->
            <div style="margin-bottom: 20px;">
                <div class="glass-card" style="padding: 20px;">
                    <h3 class="card-title">Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø§ÙŠØ¬Ø§Ø¨ÙŠØ© Ù„Ù„Ø­Ù…ÙŠØ§Øª Ø§Ù„Ù†Ø²ÙÙŠØ© ÙˆØ§Ù„ÙÙŠØ±ÙˆØ³Ø§Øª Ø§Ù„Ù…ÙØµÙ„ÙŠØ©</h3>
                    <div style="height: 400px;">
                        <canvas id="treeMapLabsChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Fourth Row: Hospital & Reports -->
            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px;">
                <!-- Risk Factors (10 bars) -->
                <div class="glass-card" style="padding: 20px;">
                    <h3 class="card-title">Ø¹ÙˆØ§Ù…Ù„ Ø§Ù„Ø®Ø·ÙˆØ±Ø© Ø§Ù„Ø§Ø¹Ù„Ù‰ Ø±ØµØ¯Ø§Ù‹</h3>
                    <div style="padding: 15px 0;">
                        <!-- Header Row -->
                        <div style="display: flex; align-items: center; margin-bottom: 15px; padding-bottom: 8px; border-bottom: 2px solid rgba(12, 197, 156, 0.3);">
                            <div style="color: #0a7c6b; font-size: 14px; font-weight: bold; width: 150px; text-align: right;">Ø§Ù„Ø¹Ø§Ù…Ù„</div>
                            <div style="flex: 1; margin-right: 10px; color: #0a7c6b; font-size: 13px; font-weight: bold; text-align: center;">Ø§Ù„Ù†Ø³Ø¨Ø©</div>
                            <div style="color: #0a7c6b; font-size: 13px; font-weight: bold; margin-right: 8px; min-width: 30px; text-align: center;">Ø§Ù„Ø¹Ø¯Ø¯</div>
                        </div>
                        
                        <div style="display: flex; align-items: center; margin: 8px 0;">
                            <div style="color: #0a7c6b; font-size: 14px; font-weight: bold; width: 150px; text-align: right;">Ø­Ø§ÙˆÙŠØ§Øª Ù…ÙŠØ§Ù‡ Ù…Ù‡Ù…Ù„Ø©</div>
                            <div class="progress-bar-container" style="flex: 1; margin-right: 10px; height: 24px;">
                                <div class="progress-bar" style="width: 72%; font-size: 10px;"> (72%)</div>
                            </div>
                            <div style="color: #0a7c6b; font-size: 12px; font-weight: bold; margin-right: 8px; min-width: 30px; text-align: center;">25</div>
                        </div>
                        <div style="display: flex; align-items: center; margin: 8px 0;">
                            <div style="color: #0a7c6b; font-size: 14px; font-weight: bold; width: 150px; text-align: right;">Ø­Ù…Ø§Ù…Ø§Øª ØºÙŠØ± Ù…Ø³ØªØ®Ø¯Ù…Ø©</div>
                            <div class="progress-bar-container" style="flex: 1; margin-right: 10px; height: 24px;">
                                <div class="progress-bar" style="width: 85%; font-size: 10px;">(85%)</div>
                            </div>
                            <div style="color: #0a7c6b; font-size: 12px; font-weight: bold; margin-right: 8px; min-width: 30px; text-align: center;">20</div>
                        </div>
                        <div style="display: flex; align-items: center; margin: 8px 0;">
                            <div style="color: #0a7c6b; font-size: 14px; font-weight: bold; width: 150px; text-align: right;">Ù…ÙŠØ§Ù‡ Ø±Ø§ÙƒØ¯Ø©</div>
                            <div class="progress-bar-container" style="flex: 1; margin-right: 10px; height: 24px;">
                                <div class="progress-bar" style="width: 65%; font-size: 10px;">(65%)</div>
                            </div>
                            <div style="color: #0a7c6b; font-size: 12px; font-weight: bold; margin-right: 8px; min-width: 30px; text-align: center;">20</div>
                        </div>
                        <div style="display: flex; align-items: center; margin: 8px 0;">
                            <div style="color: #0a7c6b; font-size: 14px; font-weight: bold; width: 150px; text-align: right;">Ø§Ù„Ø¥Ø·Ø§Ø±Ø§Øª</div>
                            <div class="progress-bar-container" style="flex: 1; margin-right: 10px; height: 24px;">
                                <div class="progress-bar" style="width: 68%; font-size: 10px;">(68%)</div>
                            </div>
                            <div style="color: #0a7c6b; font-size: 12px; font-weight: bold; margin-right: 8px; min-width: 30px; text-align: center;">15</div>
                        </div>
                        <div style="display: flex; align-items: center; margin: 8px 0;">
                            <div style="color: #0a7c6b; font-size: 14px; font-weight: bold; width: 150px; text-align: right;">Ø£ÙˆØ§Ù†ÙŠ Ø§Ù„Ø²Ù‡ÙˆØ±</div>
                            <div class="progress-bar-container" style="flex: 1; margin-right: 10px; height: 24px;">
                                <div class="progress-bar" style="width: 62%; font-size: 10px;">(62%)</div>
                            </div>
                            <div style="color: #0a7c6b; font-size: 12px; font-weight: bold; margin-right: 8px; min-width: 30px; text-align: center;">15</div>
                        </div>
                        <div style="display: flex; align-items: center; margin: 8px 0;">
                            <div style="color: #0a7c6b; font-size: 14px; font-weight: bold; width: 150px; text-align: right;">Ù‚Ù†ÙˆØ§Øª Ø§Ù„ØµØ±Ù</div>
                            <div class="progress-bar-container" style="flex: 1; margin-right: 10px; height: 24px;">
                                <div class="progress-bar" style="width: 47%; font-size: 10px;">(47%)</div>
                            </div>
                            <div style="color: #0a7c6b; font-size: 12px; font-weight: bold; margin-right: 8px; min-width: 30px; text-align: center;">15</div>
                        </div>
                        <div style="display: flex; align-items: center; margin: 8px 0;">
                            <div style="color: #0a7c6b; font-size: 14px; font-weight: bold; width: 150px; text-align: right;">Ø¨Ø±Ùƒ Ø§Ù„Ø³Ø¨Ø§Ø­Ø©</div>
                            <div class="progress-bar-container" style="flex: 1; margin-right: 10px; height: 24px;">
                                <div class="progress-bar" style="width: 58%; font-size: 10px;">(58%)</div>
                            </div>
                            <div style="color: #0a7c6b; font-size: 12px; font-weight: bold; margin-right: 8px; min-width: 30px; text-align: center;">12</div>
                        </div>
                        <div style="display: flex; align-items: center; margin: 8px 0;">
                            <div style="color: #0a7c6b; font-size: 14px; font-weight: bold; width: 150px; text-align: right;">Ø¹Ù„Ø¨ ÙØ§Ø±ØºØ©</div>
                            <div class="progress-bar-container" style="flex: 1; margin-right: 10px; height: 24px;">
                                <div class="progress-bar" style="width: 55%; font-size: 10px;">(55%)</div>
                            </div>
                            <div style="color: #0a7c6b; font-size: 12px; font-weight: bold; margin-right: 8px; min-width: 30px; text-align: center;">11</div>
                        </div>
                        <div style="display: flex; align-items: center; margin: 8px 0;">
                            <div style="color: #0a7c6b; font-size: 14px; font-weight: bold; width: 150px; text-align: right;">Ù…ÙƒÙŠÙØ§Øª Ø§Ù„Ù‡ÙˆØ§Ø¡</div>
                            <div class="progress-bar-container" style="flex: 1; margin-right: 10px; height: 24px;">
                                <div class="progress-bar" style="width: 50%; font-size: 10px;">(50%)</div>
                            </div>
                            <div style="color: #0a7c6b; font-size: 12px; font-weight: bold; margin-right: 8px; min-width: 30px; text-align: center;">10</div>
                        </div>
                        <div style="display: flex; align-items: center; margin: 8px 0;">
                            <div style="color: #0a7c6b; font-size: 14px; font-weight: bold; width: 150px; text-align: right;">ØµÙ†Ø§Ø¯ÙŠÙ‚ Ø§Ù„Ù‚Ù…Ø§Ù…Ø©</div>
                            <div class="progress-bar-container" style="flex: 1; margin-right: 10px; height: 24px;">
                                <div class="progress-bar" style="width: 44%; font-size: 10px;">(44%)</div>
                            </div>
                            <div style="color: #0a7c6b; font-size: 12px; font-weight: bold; margin-right: 8px; min-width: 30px; text-align: center;">9</div>
                        </div>
                    </div>
                    <!-- <div style="display: flex; justify-content: space-around; margin-top: 15px;">
                        <div class="legend-item">
                            <span class="legend-text">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©</span>
                            <div class="legend-box" style="background: #0cc59c;"></div>
                        </div>
                        <div class="legend-item">
                            <span class="legend-text">Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©</span>
                            <div class="legend-box" style="background: #0c9ca5;"></div>
                        </div>
                    </div> -->
                </div>

                <!-- Districts with Highest Reporting Rate -->
                <div class="glass-card" style="padding: 20px;">
                    <h3 class="card-title">Ø§Ù„Ø§Ø­ÙŠØ§Ø¡ Ø§Ù„Ø§Ø¹Ù„Ù‰ ØªØ¨Ù„ÙŠØºØ§Ù‹</h3>
                    <div style="height: 450px;">
                        <canvas id="effectivenessChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Fifth Row: Four Pie Charts -->
            <div style="margin-top: 20px;">
                <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px;">
                    <!-- Pie Chart 1 -->
                    <div class="glass-card" style="padding: 20px;">
                        <h3 class="card-title">Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ Ù„Ù„Ø²ÙŠØ§Ø±Ø© Ø§Ù„Ø­Ù‚Ù„ÙŠØ©</h3>
                        <div style="height: 200px; display: flex; justify-content: center; align-items: center;">
                            <canvas id="pieChart1" style="max-height: 180px;"></canvas>
                        </div>
                        <div style="display: flex; justify-content: space-around; margin-top: 15px;">
                            <div class="legend-item">
                                <span class="legend-text">ØªÙ… Ø§Ù„ØªÙ†Ø³ÙŠÙ‚</span>
                                <div class="legend-box" style="background: #0cc59c;"></div>
                            </div>
                            <div class="legend-item">
                                <span class="legend-text">Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªÙ†Ø³ÙŠÙ‚</span>
                                <div class="legend-box" style="background: #0c9ca5;"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Pie Chart 2 -->
                    <div class="glass-card" style="padding: 20px;">
                        <h3 class="card-title">Ø­Ø§Ù„Ø© Ø§Ù„ØªÙ‚ØµÙŠ Ø§Ù„ÙˆØ¨Ø§Ø¦ÙŠ</h3>
                        <div style="height: 200px; display: flex; justify-content: center; align-items: center;">
                            <canvas id="pieChart2" style="max-height: 180px;"></canvas>
                        </div>
                        <div style="display: flex; justify-content: space-around; margin-top: 15px;">
                            <div class="legend-item">
                                <span class="legend-text">ØªÙ… Ø§Ù„ØªÙ‚ØµÙŠ</span>
                                <div class="legend-box" style="background: #0a7c6b;"></div>
                            </div>
                            <div class="legend-item">
                                <span class="legend-text">Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªÙ‚ØµÙŠ</span>
                                <div class="legend-box" style="background: #4ecdc4;"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Pie Chart 3 -->
                    <div class="glass-card" style="padding: 20px;">
                        <h3 class="card-title">Ø§Ù„Ù…Ø³ØªÙÙŠØ¯ÙŠÙ† Ù…Ù† Ø§Ù„ØªØ«Ù‚ÙŠÙ Ø§Ù„ØµØ­ÙŠ ÙÙŠ Ù…Ù†Ø§Ø²Ù„ Ø§Ù„Ø­Ø§Ù„Ø§Øª</h3>
                        <div style="height: 200px; display: flex; justify-content: center; align-items: center;">
                            <canvas id="pieChart3" style="max-height: 180px;"></canvas>
                        </div>
                        <div style="display: flex; justify-content: space-around; margin-top: 15px;">
                            <div class="legend-item">
                                <span class="legend-text">ØªÙ… Ø§Ù„ØªØ«Ù‚ÙŠÙ</span>
                                <div class="legend-box" style="background: #5dd9c1;"></div>
                            </div>
                            <div class="legend-item">
                                <span class="legend-text">Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªØ«Ù‚ÙŠÙ</span>
                                <div class="legend-box" style="background: #3498db;"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Pie Chart 4 -->
                    <div class="glass-card" style="padding: 20px;">
                        <h3 class="card-title">>Ø§Ù„Ù…Ø³ØªÙÙŠØ¯ÙŠÙ† Ù…Ù† Ø§Ù„ØªØ«Ù‚ÙŠÙ Ø§Ù„ØµØ­ÙŠ ÙÙŠ Ø§Ù„Ù…Ø¨Ø§Ù†ÙŠ Ø§Ù„Ù…Ø¬Ø§ÙˆØ±Ø©</h3>
                        <div style="height: 200px; display: flex; justify-content: center; align-items: center;">
                            <canvas id="pieChart4" style="max-height: 180px;"></canvas>
                        </div>
                        <div style="display: flex; justify-content: space-around; margin-top: 15px;">
                            <div class="legend-item">
                                <span class="legend-text">ØªÙ… Ø§Ù„ØªØ«Ù‚ÙŠÙ</span>
                                <div class="legend-box" style="background: #f38181;"></div>
                            </div>
                            <div class="legend-item">
                                <span class="legend-text">Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªØ«Ù‚ÙŠÙ</span>
                                <div class="legend-box" style="background: #4ecdc4;"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification Toast -->
    <div id="toast" style="position: fixed; top: 100px; left: 50%; transform: translateX(-50%); background: rgba(12, 156, 165, 0.95); color: white; padding: 15px 30px; border-radius: 10px; display: none; z-index: 2000; box-shadow: 0 4px 20px rgba(0,0,0,0.3); font-weight: 600;"></div>

    <script>
        // Global chart instances
        let charts = {};

        // Initialize all charts
        Chart.defaults.color = '#0a7c6b';
        Chart.defaults.borderColor = 'rgba(12, 197, 156, 0.2)';

        // Saudi Arabia Map with GeoJSON
        let saudiGeoJSON = null;
        
        // Load GeoJSON data
        async function loadGeoJSON() {
            try {
                const response = await fetch('./HealthSectors.geojson');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                saudiGeoJSON = await response.json();
                console.log('GeoJSON loaded successfully:', saudiGeoJSON.features.length, 'features');
                generateMap();
            } catch (error) {
                console.error('Error loading GeoJSON:', error);
                console.log('Using fallback map generation');
                generateMap(); // Fallback to generate map without GeoJSON
            }
        }
        
        function generateMap() {
            const container = document.getElementById('mapContainer');
            
            // Create a centered wrapper for the map (square dimensions)
            const mapWrapper = document.createElement('div');
            mapWrapper.style.position = 'relative';
            mapWrapper.style.width = '100%';
            mapWrapper.style.height = '100%';
            mapWrapper.style.maxWidth = '530px';
            mapWrapper.style.maxHeight = '500px';
            mapWrapper.style.margin = 'auto';
            container.appendChild(mapWrapper);
            
            // Get actual dimensions after adding to DOM
            const MAP_WIDTH = 530;
            const MAP_HEIGHT = 500;
            
            // Point-in-polygon test using ray casting algorithm
            function isPointInPolygon(point, polygon) {
                let inside = false;
                for (let i = 0, j = polygon.length - 1; i < polygon.length; j = i++) {
                    const xi = polygon[i][0], yi = polygon[i][1];
                    const xj = polygon[j][0], yj = polygon[j][1];
                    
                    const intersect = ((yi > point[1]) !== (yj > point[1]))
                        && (point[0] < (xj - xi) * (point[1] - yi) / (yj - yi) + xi);
                    if (intersect) inside = !inside;
                }
                return inside;
            }
            
            // Transform Web Mercator coordinates to map container coordinates
            function transformCoordinates(coords, bounds) {
                const x = ((coords[0] - bounds.minX) / (bounds.maxX - bounds.minX)) * MAP_WIDTH;
                const y = MAP_HEIGHT - ((coords[1] - bounds.minY) / (bounds.maxY - bounds.minY)) * MAP_HEIGHT;
                return [x, y];
            }
            
            // Calculate bounds from GeoJSON
            function calculateBounds(features) {
                let minX = Infinity, minY = Infinity, maxX = -Infinity, maxY = -Infinity;
                
                features.forEach(feature => {
                    if (feature.geometry.type === 'MultiPolygon') {
                        feature.geometry.coordinates.forEach(polygon => {
                            polygon[0].forEach(coord => {
                                minX = Math.min(minX, coord[0]);
                                minY = Math.min(minY, coord[1]);
                                maxX = Math.max(maxX, coord[0]);
                                maxY = Math.max(maxY, coord[1]);
                            });
                        });
                    }
                });
                
                return { minX, minY, maxX, maxY };
            }
            
            // Check if point is inside any Saudi Arabia polygon
            function isInsideSaudiArabia(x, y, polygons, bounds) {
                if (!polygons || polygons.length === 0) return false;
                
                // Transform screen coordinates back to Web Mercator
                const mercX = (x / MAP_WIDTH) * (bounds.maxX - bounds.minX) + bounds.minX;
                const mercY = bounds.maxY - (y / MAP_HEIGHT) * (bounds.maxY - bounds.minY);
                
                for (let polygon of polygons) {
                    if (isPointInPolygon([mercX, mercY], polygon)) {
                        return true;
                    }
                }
                return false;
            }
            
            // Extract all polygons from GeoJSON
            let allPolygons = [];
            let bounds = null;
            
            if (saudiGeoJSON && saudiGeoJSON.features) {
                bounds = calculateBounds(saudiGeoJSON.features);
                
                saudiGeoJSON.features.forEach(feature => {
                    if (feature.geometry.type === 'MultiPolygon') {
                        feature.geometry.coordinates.forEach(multiPoly => {
                            allPolygons.push(multiPoly[0]);
                        });
                    }
                });
            }
            
            // Generate background dots in Saudi Arabia shape
            let dotsGenerated = 0;
            let attempts = 0;
            const maxAttempts = 5000;
            const targetDots = 1500;
            
            console.log('Generating map - GeoJSON loaded:', !!saudiGeoJSON, 'Polygons:', allPolygons.length, 'Bounds:', bounds);
            
            if (bounds && allPolygons.length > 0) {
                // Use GeoJSON data
                console.log('Using GeoJSON data for map generation');
                while (dotsGenerated < targetDots && attempts < maxAttempts) {
                    const x = Math.random() * MAP_WIDTH;
                    const y = Math.random() * MAP_HEIGHT;
                    
                    if (isInsideSaudiArabia(x, y, allPolygons, bounds)) {
                        const dot = document.createElement('div');
                        dot.className = 'map-dot';
                        dot.style.left = x + 'px';
                        dot.style.top = y + 'px';
                        dot.style.animationDelay = Math.random() * 3 + 's';
                        mapWrapper.appendChild(dot);
                        dotsGenerated++;
                    }
                    attempts++;
                }
                console.log('Generated', dotsGenerated, 'dots using GeoJSON (attempts:', attempts, ')');
            } else {
                // Fallback: simple rectangle
                console.log('Using fallback map generation (rectangle)');
                while (dotsGenerated < targetDots && attempts < maxAttempts) {
                    const x = Math.random() * MAP_WIDTH;
                    const y = Math.random() * MAP_HEIGHT;
                    
                    const dot = document.createElement('div');
                    dot.className = 'map-dot';
                    dot.style.left = x + 'px';
                    dot.style.top = y + 'px';
                    dot.style.animationDelay = Math.random() * 3 + 's';
                    mapWrapper.appendChild(dot);
                    dotsGenerated++;
                    attempts++;
                }
                console.log('Generated', dotsGenerated, 'dots using fallback');
            }

            // City data with real geographic coordinates (longitude, latitude)
            // offsetX and offsetY are in pixels to prevent label overlap
            // Cases adjusted to show full range of choropleth colors
            const cities = [
                { name: 'Ø§Ù„Ø±ÙŠØ§Ø¶', lon: 46.6753, lat: 24.7136, cases: 850, offsetX: 0, offsetY: 0 },        // Highest - darkest shade
                { name: 'Ø¬Ø¯Ø©', lon: 39.1925, lat: 21.4858, cases: 620, offsetX: -15, offsetY: -20 },       // High - dark shade
                { name: 'Ø­ÙØ± Ø§Ù„Ø¨Ø§Ø·Ù†', lon: 45.9600, lat: 28.4329, cases: 450, offsetX: 0, offsetY: 0 },   // Medium-high - medium-dark
                { name: 'Ù…ÙƒØ© Ø§Ù„Ù…ÙƒØ±Ù…Ø©', lon: 39.8579, lat: 21.3891, cases: 290, offsetX: 20, offsetY: 15 }, // Medium - medium shade
                { name: 'Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ù…Ù†ÙˆØ±Ø©', lon: 39.6113, lat: 24.5247, cases: 180, offsetX: 0, offsetY: 0 }, // Medium-low - light
                { name: 'Ø£Ø¨Ù‡Ø§', lon: 42.5053, lat: 18.2164, cases: 95, offsetX: 0, offsetY: 0 },           // Low - lighter
                { name: 'ØªØ¨ÙˆÙƒ', lon: 36.5708, lat: 28.3838, cases: 40, offsetX: 0, offsetY: 0 },           // Very low - very light
                { name: 'Ø¨Ø±ÙŠØ¯Ø©', lon: 43.9750, lat: 26.3264, cases: 12, offsetX: 0, offsetY: 0 }           // Minimal - lightest
            ];

            // Calculate choropleth color based on case count
            function getChoroplethColor(cases, maxCases) {
                if (cases === 0) return 'rgba(12, 197, 156, 0.05)';
                
                const normalized = cases / maxCases;
                // HSL color scale: lighter for fewer cases, darker for more cases
                const lightness = 85 - (normalized * 55); // 85% to 30%
                const saturation = 35 + (normalized * 45); // 35% to 80%
                return `hsla(174, ${saturation}%, ${lightness}%, 0.7)`;
            }

            function getChoroplethStroke(cases, maxCases) {
                if (cases === 0) return 'rgba(12, 197, 156, 0.3)';
                
                const normalized = cases / maxCases;
                const lightness = 85 - (normalized * 55) - 20;
                const saturation = 35 + (normalized * 45);
                return `hsl(174, ${saturation}%, ${lightness}%)`;
            }

            // Calculate cases per sector by assigning cities to sectors
            const sectorCases = {};
            
            if (bounds && saudiGeoJSON && saudiGeoJSON.features) {
                // Assign cities to health sectors
                cities.forEach(city => {
                    const mercX = city.lon * 20037508.34 / 180;
                    const mercY = Math.log(Math.tan((90 + city.lat) * Math.PI / 360)) / (Math.PI / 180);
                    const mercYConverted = mercY * 20037508.34 / 180;
                    
                    // Find which sector contains this city
                    saudiGeoJSON.features.forEach((feature, index) => {
                        if (feature.geometry.type === 'MultiPolygon') {
                            feature.geometry.coordinates.forEach(multiPoly => {
                                if (isPointInPolygon([mercX, mercYConverted], multiPoly[0])) {
                                    const sectorId = `sector_${index}`;
                                    const sectorName = feature.properties.NAME || feature.properties.NAME_EN || sectorId;
                                    if (!sectorCases[sectorId]) {
                                        sectorCases[sectorId] = { cases: 0, name: sectorName };
                                    }
                                    sectorCases[sectorId].cases += city.cases;
                                }
                            });
                        }
                    });
                });
                
                // Find max cases for color scaling
                const maxSectorCases = Math.max(...Object.values(sectorCases).map(s => s.cases), 1);
                console.log('Sector cases calculated:', sectorCases, 'Max:', maxSectorCases);

                // Draw health sector boundaries with choropleth colors
                const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
                svg.setAttribute('width', MAP_WIDTH.toString());
                svg.setAttribute('height', MAP_HEIGHT.toString());
                svg.style.position = 'absolute';
                svg.style.top = '0';
                svg.style.left = '0';
                svg.style.pointerEvents = 'none';
                svg.style.zIndex = '1';
                
                // Draw each health sector with choropleth coloring
                saudiGeoJSON.features.forEach((feature, index) => {
                    if (feature.geometry.type === 'MultiPolygon') {
                        feature.geometry.coordinates.forEach(multiPoly => {
                            const polygon = multiPoly[0];
                            
                            let pathData = '';
                            polygon.forEach((coord, i) => {
                                const transformed = transformCoordinates(coord, bounds);
                                const x = transformed[0];
                                const y = transformed[1];
                                
                                if (i === 0) {
                                    pathData += `M ${x} ${y} `;
                                } else {
                                    pathData += `L ${x} ${y} `;
                                }
                            });
                            pathData += 'Z';
                            
                            // Get sector data
                            const sectorId = `sector_${index}`;
                            const cases = sectorCases[sectorId]?.cases || 0;
                            const sectorName = sectorCases[sectorId]?.name || feature.properties.NAME || feature.properties.NAME_EN || 'Ù‚Ø·Ø§Ø¹ ØµØ­ÙŠ';
                            
                            // Calculate choropleth colors
                            const fillColor = getChoroplethColor(cases, maxSectorCases);
                            const strokeColor = getChoroplethStroke(cases, maxSectorCases);
                            
                            // Create path element
                            const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                            path.setAttribute('d', pathData);
                            path.setAttribute('fill', fillColor);
                            path.setAttribute('stroke', strokeColor);
                            path.setAttribute('stroke-width', '2');
                            path.setAttribute('stroke-linejoin', 'round');
                            path.style.transition = 'all 0.3s ease';
                            path.style.transformOrigin = 'center';
                            
                            // Store data for hover effects
                            path.dataset.originalFill = fillColor;
                            path.dataset.originalStroke = strokeColor;
                            path.dataset.cases = cases;
                            path.dataset.sectorName = sectorName;
                            path.dataset.normalized = cases / maxSectorCases;
                            
                            // Add hover effect
                            path.addEventListener('mouseenter', function() {
                                const cases = parseInt(this.dataset.cases);
                                const normalized = parseFloat(this.dataset.normalized);
                                
                                if (cases > 0) {
                                    const lightness = 85 - (normalized * 55) - 10;
                                    const saturation = 35 + (normalized * 45) + 10;
                                    this.setAttribute('fill', `hsla(174, ${saturation}%, ${lightness}%, 0.85)`);
                                    this.setAttribute('stroke', `hsl(174, ${saturation}%, ${lightness - 20}%)`);
                                } else {
                                    this.setAttribute('fill', 'rgba(12, 197, 156, 0.2)');
                                    this.setAttribute('stroke', 'rgba(12, 197, 156, 0.6)');
                                }
                                this.setAttribute('stroke-width', '3');
                                this.style.filter = 'drop-shadow(0 4px 8px rgba(12, 156, 165, 0.5))';
                            });
                            
                            path.addEventListener('mouseleave', function() {
                                this.setAttribute('fill', this.dataset.originalFill);
                                this.setAttribute('stroke', this.dataset.originalStroke);
                                this.setAttribute('stroke-width', '2');
                                this.style.filter = 'none';
                            });
                            
                            // Add click event
                            path.style.pointerEvents = 'auto';
                            path.style.cursor = 'pointer';
                            path.addEventListener('click', function() {
                                const cases = this.dataset.cases;
                                const sectorName = this.dataset.sectorName;
                                if (cases > 0) {
                                    showNotification(`${sectorName}: ${cases} Ø­Ø§Ù„Ø©`);
                                } else {
                                    showNotification(`${sectorName}: Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø§Ù„Ø§Øª`);
                                }
                            });
                            
                            svg.appendChild(path);
                        });
                    }
                });
                
                mapWrapper.appendChild(svg);
                console.log('Choropleth map drawn:', saudiGeoJSON.features.length, 'sectors');
                
                // Create legends container to hold both legends stacked
                const legendsContainer = document.createElement('div');
                legendsContainer.style.cssText = `
                    display: flex;
                    flex-direction: column;
                    gap: 8px;
                `;
                
                // Add circle size legend (top)
                const circleLegend = document.createElement('div');
                circleLegend.style.cssText = `
                    background: rgba(255, 255, 255, 0.95);
                    backdrop-filter: blur(10px);
                    border: 1px solid rgba(231, 76, 60, 0.4);
                    border-radius: 6px;
                    padding: 8px 10px;
                    box-shadow: 2px 2px 4px #f5c6cb, -2px -2px 4px #ffffff;
                `;

                const circleLegendTitle = document.createElement('div');
                circleLegendTitle.textContent = 'Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø§Øª';
                circleLegendTitle.style.cssText = `
                    color: #c0392b;
                    font-size: 11px;
                    font-weight: 700;
                    margin-bottom: 6px;
                    text-align: center;
                `;
                circleLegend.appendChild(circleLegendTitle);

                // Create circle size scale matching the color scale intervals
                const circleSizes = [
                    { cases: 900, label: '900+' },
                    { cases: 725, label: '700-750' },
                    { cases: 525, label: '500-550' },
                    { cases: 325, label: '300-350' },
                    { cases: 125, label: '100-150' },
                    { cases: 25, label: '0-50' }
                ];
                
                const circleScale = document.createElement('div');
                circleScale.style.cssText = `
                    display: flex;
                    flex-direction: column;
                    gap: 4px;
                    align-items: center;
                    padding: 4px 0;
                `;

                circleSizes.forEach(size => {
                    // Calculate radius for this size (scaled down by 0.5 for legend display)
                    const minRadius = 4;
                    const maxRadius = 12.5;
                    const referenceCases = 900;
                    const minCasesForCalc = 25;
                    const effectiveCases = Math.min(size.cases, referenceCases);
                    const normalized = (effectiveCases - minCasesForCalc) / (referenceCases - minCasesForCalc);
                    const radius = (minRadius + (normalized * (maxRadius - minRadius))) * 0.5;

                    const circleItem = document.createElement('div');
                    circleItem.style.cssText = `
                        display: flex;
                        align-items: center;
                        gap: 8px;
                        width: 100%;
                        justify-content: space-between;
                        padding: 0 2px;
                    `;

                    const circle = document.createElement('div');
                    circle.style.cssText = `
                        width: ${radius * 2}px;
                        height: ${radius * 2}px;
                        background: rgba(231, 76, 60, 0.6);
                        border: 1px solid #c0392b;
                        border-radius: 50%;
                        flex-shrink: 0;
                    `;

                    const label = document.createElement('div');
                    label.textContent = size.label;
                    label.style.cssText = `
                        color: #c0392b;
                        font-size: 10px;
                        font-weight: 600;
                        text-align: right;
                        flex-grow: 1;
                    `;

                    circleItem.appendChild(circle);
                    circleItem.appendChild(label);
                    circleScale.appendChild(circleItem);
                });
                
                circleLegend.appendChild(circleScale);
                legendsContainer.appendChild(circleLegend);
                
                // Add color scale legend (bottom)
                const colorLegend = document.createElement('div');
                colorLegend.style.cssText = `
                    background: rgba(255, 255, 255, 0.95);
                    backdrop-filter: blur(10px);
                    border: 1px solid rgba(12, 197, 156, 0.4);
                    border-radius: 6px;
                    padding: 8px 10px;
                    box-shadow: 2px 2px 4px #b8d4d2, -2px -2px 4px #ffffff;
                `;

                const legendTitle = document.createElement('div');
                legendTitle.textContent = 'Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ù…Ù†Ø§Ø·Ù‚';
                legendTitle.style.cssText = `
                    color: #0a7c6b;
                    font-size: 11px;
                    font-weight: 700;
                    margin-bottom: 6px;
                    text-align: center;
                `;
                colorLegend.appendChild(legendTitle);

                // Create gradient scale with fixed intervals
                const gradientScale = document.createElement('div');
                gradientScale.style.cssText = `
                    display: flex;
                    flex-direction: column;
                    gap: 3px;
                    max-height: 180px;
                    overflow-y: auto;
                `;

                // Add custom scrollbar styling for legend
                gradientScale.style.overflowY = 'auto';
                gradientScale.style.paddingRight = '2px';

                // Define simplified intervals (reduced number)
                const intervals = [
                    { min: 900, max: 1050, label: '900+' },
                    { min: 700, max: 750, label: '700-750' },
                    { min: 500, max: 550, label: '500-550' },
                    { min: 300, max: 350, label: '300-350' },
                    { min: 100, max: 150, label: '100-150' },
                    { min: 0, max: 50, label: '0-50' }
                ];
                
                // Generate color scale for each interval
                intervals.forEach(interval => {
                    // Use middle value of interval for color calculation
                    const midValue = (interval.min + interval.max) / 2;
                    const color = getChoroplethColor(midValue, 1000);

                    const scaleItem = document.createElement('div');
                    scaleItem.style.cssText = `
                        display: flex;
                        align-items: center;
                        gap: 6px;
                    `;

                    const colorBox = document.createElement('div');
                    colorBox.style.cssText = `
                        width: 16px;
                        height: 10px;
                        background: ${color};
                        border: 1px solid rgba(12, 197, 156, 0.4);
                        border-radius: 2px;
                        flex-shrink: 0;
                    `;

                    const label = document.createElement('div');
                    label.textContent = interval.label;
                    label.style.cssText = `
                        color: #0a7c6b;
                        font-size: 9px;
                        font-weight: 600;
                        min-width: 45px;
                        line-height: 1.2;
                    `;

                    scaleItem.appendChild(colorBox);
                    scaleItem.appendChild(label);
                    gradientScale.appendChild(scaleItem);
                });
                
                colorLegend.appendChild(gradientScale);
                legendsContainer.appendChild(colorLegend);
                
                // Add the legends container to the external legends container
                document.getElementById('mapLegendsContainer').appendChild(legendsContainer);
            }

            // Add city markers on top of choropleth as scaled circles with diverse sizes
            // Use 900 cases as reference for max circle size to match legend
            const referenceCases = 900;
            const minCases = Math.min(...cities.map(c => c.cases));
            
            cities.forEach((city, index) => {
                // Convert lat/lon to Web Mercator (EPSG:3857)
                const mercX = city.lon * 20037508.34 / 180;
                const mercY = Math.log(Math.tan((90 + city.lat) * Math.PI / 360)) / (Math.PI / 180);
                const mercYConverted = mercY * 20037508.34 / 180;
                
                // Transform to screen coordinates if bounds are available
                if (bounds) {
                    const screenCoords = transformCoordinates([mercX, mercYConverted], bounds);
                    
                    const finalX = screenCoords[0];
                    const finalY = screenCoords[1];
                    
                    // Calculate circle size based on cases with more dramatic scaling
                    // Scale between 5px (for 0-50 cases) and 20px radius (for 900+ cases)
                    const minRadius = 5;
                    const maxRadius = 20;
                    const effectiveCases = Math.min(city.cases, referenceCases);
                    const normalized = (effectiveCases - minCases) / (referenceCases - minCases);
                    const radius = minRadius + (normalized * (maxRadius - minRadius));
                    
                    // Create circular marker
                    const marker = document.createElement('div');
                    marker.style.cssText = `
                        position: absolute;
                        left: ${finalX}px;
                        top: ${finalY}px;
                        width: ${radius * 2}px;
                        height: ${radius * 2}px;
                        background: rgba(231, 76, 60, 0.6);
                        border: 2px solid #c0392b;
                        border-radius: 50%;
                        cursor: pointer;
                        z-index: 15;
                        transform: translate(-50%, -50%);
                        transition: all 0.3s ease;
                        box-shadow: 0 2px 8px rgba(231, 76, 60, 0.4);
                    `;
                    marker.title = `${city.name}: ${city.cases} Ø­Ø§Ù„Ø©`;
                    
                    // Add hover effect
                    marker.addEventListener('mouseenter', function() {
                        this.style.transform = 'translate(-50%, -50%) scale(1.2)';
                        this.style.background = 'rgba(231, 76, 60, 0.8)';
                        this.style.boxShadow = '0 4px 12px rgba(231, 76, 60, 0.6)';
                        this.style.zIndex = '25';
                    });
                    
                    marker.addEventListener('mouseleave', function() {
                        this.style.transform = 'translate(-50%, -50%) scale(1)';
                        this.style.background = 'rgba(231, 76, 60, 0.6)';
                        this.style.boxShadow = '0 2px 8px rgba(231, 76, 60, 0.4)';
                        this.style.zIndex = '15';
                    });
                    
                    marker.onclick = () => showNotification(`${city.name}: ${city.cases} Ø­Ø§Ù„Ø© Ù…Ø¤ÙƒØ¯Ø©`);
                    
                    mapWrapper.appendChild(marker);
                }
            });
        }

        // Activity Line Chart
        function createActivityChart() {
            const ctx = document.getElementById('activityChart').getContext('2d');
            
            // Custom plugin to draw background zones
            const backgroundZonesPlugin = {
                id: 'backgroundZones',
                beforeDraw: (chart) => {
                    const { ctx, chartArea: { left, right, top, bottom }, scales: { y } } = chart;
                    
                    // Calculate Y positions for zone boundaries
                    const safeZoneTop = y.getPixelForValue(5);
                    const alertZoneTop = y.getPixelForValue(15);
                    
                    // Draw Safe Zone (0-5) - Green
                    ctx.fillStyle = 'rgba(34, 197, 94, 0.15)'; // Green with transparency
                    ctx.fillRect(left, safeZoneTop, right - left, bottom - safeZoneTop);
                    
                    // Draw Alert Zone (5-15) - Yellow/Orange
                    ctx.fillStyle = 'rgba(251, 191, 36, 0.15)'; // Yellow/Orange with transparency
                    ctx.fillRect(left, alertZoneTop, right - left, safeZoneTop - alertZoneTop);
                    
                    // Draw Danger Zone (15+) - Red
                    ctx.fillStyle = 'rgba(239, 68, 68, 0.15)'; // Red with transparency
                    ctx.fillRect(left, top, right - left, alertZoneTop - top);
                    
                    // Draw zone boundary lines
                    ctx.strokeStyle = 'rgba(34, 197, 94, 0.5)';
                    ctx.lineWidth = 2;
                    ctx.setLineDash([5, 5]);
                    ctx.beginPath();
                    ctx.moveTo(left, safeZoneTop);
                    ctx.lineTo(right, safeZoneTop);
                    ctx.stroke();
                    
                    ctx.strokeStyle = 'rgba(251, 191, 36, 0.5)';
                    ctx.beginPath();
                    ctx.moveTo(left, alertZoneTop);
                    ctx.lineTo(right, alertZoneTop);
                    ctx.stroke();
                    ctx.setLineDash([]);
                    
                    // Add zone labels with stroke for prominence
                    ctx.font = 'bold 14px Arial';
                    ctx.textAlign = 'right';
                    ctx.lineWidth = 3;
                    
                    // Safe Zone label
                    ctx.strokeStyle = 'rgba(255, 255, 255, 0.9)';
                    ctx.fillStyle = 'rgba(34, 197, 94, 1)';
                    ctx.strokeText('Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø§Ù…Ø§Ù†', right - 15, bottom - 15);
                    ctx.fillText('Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø§Ù…Ø§Ù†', right - 15, bottom - 15);
                    
                    // Alert Zone label
                    ctx.strokeStyle = 'rgba(255, 255, 255, 0.9)';
                    ctx.fillStyle = 'rgba(251, 191, 36, 1)';
                    ctx.strokeText('Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø§Ù†Ø°Ø§Ø±', right - 15, (safeZoneTop + alertZoneTop) / 2);
                    ctx.fillText('Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø§Ù†Ø°Ø§Ø±', right - 15, (safeZoneTop + alertZoneTop) / 2);
                    
                    // Danger Zone label
                    ctx.strokeStyle = 'rgba(255, 255, 255, 0.9)';
                    ctx.fillStyle = 'rgba(239, 68, 68, 1)';
                    ctx.strokeText('Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø®Ø·Ø±', right - 15, (top + alertZoneTop) / 2 + 10);
                    ctx.fillText('Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø®Ø·Ø±', right - 15, (top + alertZoneTop) / 2 + 10);
                }
            };
            
            charts.activity = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: Array.from({length: 53}, (_, i) => i + 1),
                    datasets: [
                        {
                            label: ' 2025',
                            data: generateRandomData(53, 15, 30),
                            borderColor: '#0cc59c',
                            backgroundColor: 'rgba(12, 197, 156, 0)',
                            tension: 0.4,
                            fill: false,
                            borderWidth: 2
                        },
                        {
                            label: ' 2021',
                            data: generateRandomData(53, 8, 20),
                            borderColor: '#0c9ca5',
                            backgroundColor: 'rgba(12, 156, 165, 0)',
                            tension: 0.4,
                            fill: false,
                            borderWidth: 2
                        },
                        {
                            label: ' 2022',
                            data: generateRandomData(53, 10, 25),
                            borderColor: '#3498db',
                            backgroundColor: 'rgba(52, 152, 219, 0)',
                            tension: 0.4,
                            fill: false,
                            borderWidth: 2
                        },
                        {
                            label: ' 2023',
                            data: generateRandomData(53, 12, 28),
                            borderColor: '#9b59b6',
                            backgroundColor: 'rgba(155, 89, 182, 0)',
                            tension: 0.4,
                            fill: false,
                            borderWidth: 2
                        },
                        {
                            label: ' 2024',
                            data: generateRandomData(53, 8, 22),
                            borderColor: '#e67e22',
                            backgroundColor: 'rgba(230, 126, 34, 0)',
                            tension: 0.4,
                            fill: false,
                            borderWidth: 2
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: { mode: 'index', intersect: false },
                    plugins: {
                        legend: { display: true, position: 'bottom', labels: { padding: 10, font: { size: 11 } } },
                        tooltip: { backgroundColor: 'rgba(10, 124, 107, 0.95)', padding: 12 }
                    },
                    scales: {
                        y: { 
                            beginAtZero: true, 
                            max: 35,
                            grid: { color: 'rgba(12, 197, 156, 0.2)' }, 
                            ticks: { font: { size: 10 } } 
                        },
                        x: { grid: { display: false }, ticks: { font: { size: 10 } } }
                    }
                },
                plugins: [backgroundZonesPlugin]
            });
        }

        // Donut Chart (for Case Type chart only)
        function createDonutChart(elementId, label1, label2, color1, color2) {
            const ctx = document.getElementById(elementId).getContext('2d');
            const value1 = Math.floor(Math.random() * 800) + 200; // Random between 200-1000
            const value2 = Math.floor(Math.random() * 800) + 200; // Random between 200-1000
            
            charts[elementId] = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: [label1, label2],
                    datasets: [{
                        data: [value1, value2],
                        backgroundColor: [color1, 'rgba(220, 220, 220, 0.3)'],
                        borderWidth: 0,
                        spacing: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    cutout: '65%',
                    plugins: {
                        legend: { display: false },
                        tooltip: { 
                            backgroundColor: 'rgba(10, 124, 107, 0.95)', 
                            padding: 12,
                            displayColors: false,
                            callbacks: {
                                label: function(context) {
                                    return context.label + ': ' + context.parsed;
                                }
                            }
                        }
                    }
                },
                plugins: [{
                    id: 'centerText',
                    afterDatasetsDraw: function(chart) {
                        const width = chart.width;
                        const height = chart.height;
                        const ctx = chart.ctx;
                        
                        ctx.restore();
                        const fontSize = Math.min(width, height) / 4.5;
                        ctx.font = "bold " + fontSize + "px Sakkal Majalla, Arial, sans-serif";
                        ctx.textBaseline = "middle";
                        ctx.textAlign = "center";
                        ctx.fillStyle = "#0a7c6b";
                        
                        // Calculate and display percentage in center
                        const currentValue = chart.data.datasets[0].data[0];
                        const total = chart.data.datasets[0].data.reduce((a, b) => a + b, 0);
                        const percentage = Math.round((currentValue / total) * 100);
                        const text = percentage + "%";
                        const textX = width / 2;
                        const textY = height / 2;
                        
                        ctx.fillText(text, textX, textY);
                        ctx.save();
                    }
                }]
            });
        }

        // Pie Charts (for other charts)
        function createPieChart(elementId, label1, label2, color1, color2) {
            const ctx = document.getElementById(elementId).getContext('2d');
            const value1 = Math.floor(Math.random() * 800) + 200; // Random between 200-1000
            const value2 = Math.floor(Math.random() * 800) + 200; // Random between 200-1000
            
            charts[elementId] = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: [label1, label2],
                    datasets: [{
                        data: [value1, value2],
                        backgroundColor: [color1, color2],
                        borderWidth: 2,
                        borderColor: 'rgba(255, 255, 255, 0.8)',
                        spacing: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: { display: false },
                        tooltip: { 
                            backgroundColor: 'rgba(10, 124, 107, 0.95)', 
                            padding: 12,
                            displayColors: false,
                            callbacks: {
                                label: function(context) {
                                    return context.label + ': ' + context.parsed;
                                }
                            }
                        },
                        datalabels: {
                            color: '#fff',
                            font: {
                                weight: 'bold',
                                size: 14,
                                family: 'Sakkal Majalla, Arial, sans-serif'
                            },
                            formatter: (value, ctx) => {
                                return value;
                            },
                            textAlign: 'center',
                            anchor: 'center',
                            align: 'center'
                        }
                    }
                },
                plugins: [{
                    id: 'pieLabels',
                    afterDatasetsDraw: function(chart) {
                        const ctx = chart.ctx;
                        const dataset = chart.data.datasets[0];
                        const total = dataset.data.reduce((a, b) => a + b, 0);
                        
                        chart.data.datasets.forEach((dataset, datasetIndex) => {
                            const meta = chart.getDatasetMeta(datasetIndex);
                            
                            meta.data.forEach((element, index) => {
                                const value = dataset.data[index];
                                const percentage = Math.round((value / total) * 100);
                                
                                // Get the center position of the pie slice
                                const model = element;
                                const midAngle = (model.startAngle + model.endAngle) / 2;
                                const midRadius = (model.innerRadius + model.outerRadius) / 2;
                                
                                const x = model.x + Math.cos(midAngle) * midRadius * 0.7;
                                const y = model.y + Math.sin(midAngle) * midRadius * 0.7;
                                
                                // Draw percentage on pie slice
                                ctx.fillStyle = '#fff';
                                ctx.font = 'bold 16px Sakkal Majalla, Arial, sans-serif';
                                ctx.textAlign = 'center';
                                ctx.textBaseline = 'middle';
                                
                                // Draw percentage
                                ctx.fillText(percentage + '%', x, y);
                            });
                        });
                    }
                }]
            });
        }

        // Bar Charts
        function createBarChart(elementId, labels, datasets) {
            const ctx = document.getElementById(elementId).getContext('2d');
            charts[elementId] = new Chart(ctx, {
                type: 'bar',
                data: { labels, datasets },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: { backgroundColor: 'rgba(10, 124, 107, 0.95)', padding: 12 }
                    },
                    scales: {
                        y: { beginAtZero: true, grid: { color: 'rgba(12, 197, 156, 0.2)' }, ticks: { font: { size: 10 } } },
                        x: { grid: { display: false }, ticks: { font: { size: 10 } } }
                    }
                }
            });
        }

        // Horizontal Bar Chart
        function createHorizontalBarChart(elementId, labels, datasets) {
            const ctx = document.getElementById(elementId).getContext('2d');
            
            charts[elementId] = new Chart(ctx, {
                type: 'bar',
                data: { labels, datasets },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: { 
                            backgroundColor: 'rgba(10, 124, 107, 0.95)', 
                            padding: 12,
                            callbacks: {
                                label: function(context) {
                                    const cases = context.parsed.x;
                                    return cases.toLocaleString('en-US') + ' Ø­Ø§Ù„Ø©';
                                }
                            }
                        }
                    },
                    scales: {
                        x: { 
                            beginAtZero: true,
                            grid: { color: 'rgba(12, 197, 156, 0.2)' }, 
                            ticks: { 
                                font: { size: 11 }
                            }
                        },
                        y: { 
                            grid: { display: false }, 
                            ticks: { font: { size: 11 } } 
                        }
                    }
                }
            });
        }

        // Stacked Horizontal Bar Chart
        function createStackedHorizontalBarChart(elementId, labels, datasets) {
            const ctx = document.getElementById(elementId).getContext('2d');
            
            // Plugin to display percentages inside each bar segment
            const stackedPercentagePlugin = {
                id: 'stackedPercentagePlugin',
                afterDatasetsDraw(chart) {
                    const { ctx, data, scales: { x, y } } = chart;
                    ctx.save();
                    ctx.font = 'bold 11px Arial';
                    ctx.fillStyle = '#ffffff';
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    ctx.shadowColor = 'rgba(0, 0, 0, 0.3)';
                    ctx.shadowBlur = 2;
                    
                    data.labels.forEach((label, index) => {
                        let totalValue = 0;
                        data.datasets.forEach(dataset => {
                            totalValue += dataset.data[index];
                        });
                        
                        let cumulativeValue = 0;
                        data.datasets.forEach((dataset, datasetIndex) => {
                            const meta = chart.getDatasetMeta(datasetIndex);
                            const bar = meta.data[index];
                            const value = dataset.data[index];
                            const percentage = ((value / totalValue) * 100).toFixed(1);
                            
                            // Calculate position for text (center of each segment)
                            const segmentWidth = bar.width;
                            const xStart = x.getPixelForValue(cumulativeValue);
                            const xEnd = x.getPixelForValue(cumulativeValue + value);
                            const xPos = (xStart + xEnd) / 2;
                            const yPos = bar.y;
                            
                            // Only display if segment is wide enough
                            if (segmentWidth > 30) {
                                ctx.fillText(percentage + '%', xPos, yPos);
                            }
                            
                            cumulativeValue += value;
                        });
                    });
                    
                    ctx.restore();
                }
            };
            
            charts[elementId] = new Chart(ctx, {
                type: 'bar',
                data: { labels, datasets },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { 
                            display: true,
                            position: 'bottom',
                            labels: {
                                padding: 10,
                                font: { size: 11 },
                                usePointStyle: true
                            }
                        },
                        tooltip: { 
                            backgroundColor: 'rgba(10, 124, 107, 0.95)', 
                            padding: 12,
                            callbacks: {
                                label: function(context) {
                                    const label = context.dataset.label || '';
                                    const value = context.parsed.x;
                                    // Calculate percentage
                                    const dataIndex = context.dataIndex;
                                    let total = 0;
                                    context.chart.data.datasets.forEach(dataset => {
                                        total += dataset.data[dataIndex];
                                    });
                                    const percentage = ((value / total) * 100).toFixed(1);
                                    return label + ': ' + value + ' (' + percentage + '%)';
                                }
                            }
                        }
                    },
                    scales: {
                        x: { 
                            stacked: true,
                            beginAtZero: true,
                            grid: { color: 'rgba(12, 197, 156, 0.2)' }, 
                            ticks: { 
                                font: { size: 11 }
                            }
                        },
                        y: { 
                            stacked: true,
                            grid: { display: false }, 
                            ticks: { font: { size: 11 } } 
                        }
                    }
                },
                plugins: [stackedPercentagePlugin]
            });
        }

        // Combined Bar and Line Chart
        function createCombinedBarLineChart(elementId, labels, barDatasets, lineData) {
            const ctx = document.getElementById(elementId).getContext('2d');
            
            // Combine bar datasets with line dataset
            const allDatasets = [...barDatasets, {
                label: 'Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ',
                data: lineData,
                type: 'line',
                borderColor: '#0a7c6b',
                backgroundColor: 'rgba(10, 124, 107, 0.1)',
                borderWidth: 3,
                tension: 0.4,
                fill: false,
                pointRadius: 5,
                pointBackgroundColor: '#0a7c6b',
                pointBorderColor: '#fff',
                pointBorderWidth: 2,
                pointHoverRadius: 7,
                yAxisID: 'y1'
            }];
            
            charts[elementId] = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: allDatasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    categoryPercentage: 0.1,
                    barPercentage: 0.95,
                    interaction: {
                        mode: 'index',
                        intersect: false
                    },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'bottom',
                            labels: {
                                padding: 10,
                                font: { size: 11 },
                                usePointStyle: true,
                                boxWidth: 8
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(10, 124, 107, 0.95)',
                            padding: 12,
                            displayColors: true
                        }
                    },
                    scales: {
                        x: {
                            grid: { 
                                display: true,
                                color: 'rgba(67, 67, 67, 0.8)',
                                lineWidth: 0.6,
                                drawOnChartArea: true,
                                drawTicks: true
                            },
                            ticks: { font: { size: 10 } }
                        },
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            beginAtZero: true,
                            grid: { color: 'rgba(12, 197, 156, 0.2)' },
                            ticks: { font: { size: 10 } },
                            title: {
                                display: true,
                                text: 'Ø¹Ø¯Ø¯ Ø§Ù„Ø¹ÙŠÙ†Ø§Øª',
                                font: { size: 11, weight: 'bold' },
                                color: '#0a7c6b'
                            }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            beginAtZero: true,
                            grid: { drawOnChartArea: false },
                            ticks: { font: { size: 10 } },
                            title: {
                                display: true,
                                text: 'Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ',
                                font: { size: 11, weight: 'bold' },
                                color: '#0a7c6b'
                            }
                        }
                    }
                }
            });
        }

        // TreeMap Chart
        function createTreeMapChart(elementId, data) {
            const ctx = document.getElementById(elementId).getContext('2d');
            
            charts[elementId] = new Chart(ctx, {
                type: 'treemap',
                data: {
                    datasets: [{
                        tree: data,
                        key: 'value',
                        groups: ['category', 'label'],
                        spacing: 2,
                        borderWidth: 3,
                        borderColor: 'white',
                        backgroundColor: (ctx) => {
                            if (!ctx.raw) return 'rgba(12, 197, 156, 0.8)';
                            const category = ctx.raw._data.category;
                            const colors = {
                                'Ø§Ù„Ù…Ø®ØªØ¨Ø± Ø§Ù„Ø§Ù‚Ù„ÙŠÙ…ÙŠ': 'rgba(52, 152, 219, 0.8)',    // Blue
                                'Ø§Ù„Ù…Ø®ØªØ¨Ø± Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ': 'rgba(230, 126, 34, 0.8)',    // Orange
                                'Ù…Ø®ØªØ¨Ø± ÙˆÙ‚Ø§ÙŠØ©': 'rgba(46, 204, 113, 0.8)',    // Green
                                'Ù…Ø®ØªØ¨Ø± Ø¨Ù†Ùƒ Ø§Ù„Ø¯Ù…': 'rgba(26, 188, 156, 0.8)',     // Teal
                                'Ù…Ø®ØªØ¨Ø± Ø§Ù„Ù…ÙŠÙƒØ±ÙˆØ¨ÙŠÙˆÙ„ÙˆØ¬ÙŠØ§': 'rgba(74, 137, 117, 0.8)'     // Teal-Green from image
                            };
                            return colors[category] || 'rgba(12, 197, 156, 0.8)';
                        },
                        labels: {
                            display: true,
                            align: 'center',
                            position: 'middle',
                            color: 'white',
                            font: {
                                size: 12,
                                weight: 'bold',
                                family: 'Sakkal Majalla, Arial, sans-serif'
                            },
                            formatter: (ctx) => {
                                if (!ctx.raw) return '';
                                // Return the disease name (label)
                                return ctx.raw._data.label;
                            }
                        },
                        captions: {
                            display: true,
                            align: 'center',
                            padding: 4,
                            color: 'white',
                            font: {
                                size: 14,
                                weight: 'bold',
                                family: 'Sakkal Majalla, Arial, sans-serif'
                            },
                            formatter: (ctx) => {
                                if (!ctx.raw) return '';
                                return ctx.raw.g;
                            }
                        }
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            backgroundColor: 'rgba(10, 124, 107, 0.95)',
                            padding: 12,
                            displayColors: false,
                            callbacks: {
                                title: (context) => {
                                    return context[0].raw._data.label;
                                },
                                label: (context) => {
                                    // Return both lines: total and individual value as integers
                                    const total = Math.floor(context.raw.g);
                                    const value = Math.floor(context.raw.v);
                                    return ['Ø§Ù„Ø§Ø¬Ù…Ø§Ù„ÙŠ: ' + total, 'Ø§Ù„Ù‚ÙŠÙ…Ø©: ' + value];
                                }
                            }
                        }
                    }
                }
            });
        }

        // Small trend charts
        function createTrendChart(elementId, color) {
            const ctx = document.getElementById(elementId).getContext('2d');
            charts[elementId] = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['', '', '', '', '', '', ''],
                    datasets: [{
                        data: generateRandomData(7, 30, 70),
                        borderColor: color,
                        backgroundColor: `${color}33`,
                        tension: 0.4,
                        fill: true,
                        pointRadius: 0,
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false }, tooltip: { enabled: false } },
                    scales: { y: { display: false }, x: { display: false } }
                }
            });
        }

        // Helper function
        function generateRandomData(count, min, max) {
            return Array.from({length: count}, () => Math.floor(Math.random() * (max - min + 1)) + min);
        }

        // Ministry activities data - no longer needs separate function
        // Chart is created once and updated with filter changes

        // Static data based on filters
        const staticData = {
            all: {
                moh: { worldPercent: 45, saudiPercent: 55, malePercent: 48, femalePercent: 52, totalCases: 2645, recoveredCases: 2423, activeCases: 187 },
                momra: { worldPercent: 42, saudiPercent: 58, malePercent: 50, femalePercent: 50, totalCases: 1850, recoveredCases: 1698, activeCases: 131 },
                env: { worldPercent: 38, saudiPercent: 62, malePercent: 52, femalePercent: 48, totalCases: 1323, recoveredCases: 1212, activeCases: 93 },
                all: { worldPercent: 43, saudiPercent: 57, malePercent: 49, femalePercent: 51, totalCases: 3215, recoveredCases: 2945, activeCases: 245 }
            },
            riyadh: {
                moh: { worldPercent: 48, saudiPercent: 52, malePercent: 46, femalePercent: 54, totalCases: 850, recoveredCases: 780, activeCases: 62 },
                momra: { worldPercent: 45, saudiPercent: 55, malePercent: 48, femalePercent: 52, totalCases: 595, recoveredCases: 546, activeCases: 43 },
                env: { worldPercent: 40, saudiPercent: 60, malePercent: 50, femalePercent: 50, totalCases: 425, recoveredCases: 390, activeCases: 31 },
                all: { worldPercent: 46, saudiPercent: 54, malePercent: 47, femalePercent: 53, totalCases: 1034, recoveredCases: 948, activeCases: 75 }
            },
            jeddah: {
                moh: { worldPercent: 43, saudiPercent: 57, malePercent: 49, femalePercent: 51, totalCases: 620, recoveredCases: 568, activeCases: 45 },
                momra: { worldPercent: 40, saudiPercent: 60, malePercent: 51, femalePercent: 49, totalCases: 434, recoveredCases: 398, activeCases: 32 },
                env: { worldPercent: 36, saudiPercent: 64, malePercent: 53, femalePercent: 47, totalCases: 310, recoveredCases: 284, activeCases: 23 },
                all: { worldPercent: 41, saudiPercent: 59, malePercent: 50, femalePercent: 50, totalCases: 754, recoveredCases: 691, activeCases: 55 }
            },
            makkah: {
                moh: { worldPercent: 40, saudiPercent: 60, malePercent: 47, femalePercent: 53, totalCases: 290, recoveredCases: 266, activeCases: 21 },
                momra: { worldPercent: 38, saudiPercent: 62, malePercent: 49, femalePercent: 51, totalCases: 203, recoveredCases: 186, activeCases: 15 },
                env: { worldPercent: 35, saudiPercent: 65, malePercent: 51, femalePercent: 49, totalCases: 145, recoveredCases: 133, activeCases: 11 },
                all: { worldPercent: 39, saudiPercent: 61, malePercent: 48, femalePercent: 52, totalCases: 353, recoveredCases: 323, activeCases: 26 }
            },
            madinah: {
                moh: { worldPercent: 38, saudiPercent: 62, malePercent: 45, femalePercent: 55, totalCases: 180, recoveredCases: 165, activeCases: 13 },
                momra: { worldPercent: 36, saudiPercent: 64, malePercent: 47, femalePercent: 53, totalCases: 126, recoveredCases: 116, activeCases: 9 },
                env: { worldPercent: 33, saudiPercent: 67, malePercent: 49, femalePercent: 51, totalCases: 90, recoveredCases: 83, activeCases: 7 },
                all: { worldPercent: 37, saudiPercent: 63, malePercent: 46, femalePercent: 54, totalCases: 219, recoveredCases: 201, activeCases: 16 }
            },
            dammam: {
                moh: { worldPercent: 42, saudiPercent: 58, malePercent: 50, femalePercent: 50, totalCases: 350, recoveredCases: 321, activeCases: 25 },
                momra: { worldPercent: 40, saudiPercent: 60, malePercent: 52, femalePercent: 48, totalCases: 245, recoveredCases: 225, activeCases: 18 },
                env: { worldPercent: 37, saudiPercent: 63, malePercent: 54, femalePercent: 46, totalCases: 175, recoveredCases: 161, activeCases: 13 },
                all: { worldPercent: 41, saudiPercent: 59, malePercent: 51, femalePercent: 49, totalCases: 426, recoveredCases: 391, activeCases: 30 }
            },
            khobar: {
                moh: { worldPercent: 41, saudiPercent: 59, malePercent: 49, femalePercent: 51, totalCases: 280, recoveredCases: 257, activeCases: 20 },
                momra: { worldPercent: 39, saudiPercent: 61, malePercent: 51, femalePercent: 49, totalCases: 196, recoveredCases: 180, activeCases: 14 },
                env: { worldPercent: 36, saudiPercent: 64, malePercent: 53, femalePercent: 47, totalCases: 140, recoveredCases: 129, activeCases: 10 },
                all: { worldPercent: 40, saudiPercent: 60, malePercent: 50, femalePercent: 50, totalCases: 341, recoveredCases: 313, activeCases: 25 }
            },
            taif: {
                moh: { worldPercent: 37, saudiPercent: 63, malePercent: 46, femalePercent: 54, totalCases: 150, recoveredCases: 138, activeCases: 11 },
                momra: { worldPercent: 35, saudiPercent: 65, malePercent: 48, femalePercent: 52, totalCases: 105, recoveredCases: 97, activeCases: 8 },
                env: { worldPercent: 32, saudiPercent: 68, malePercent: 50, femalePercent: 50, totalCases: 75, recoveredCases: 69, activeCases: 6 },
                all: { worldPercent: 36, saudiPercent: 64, malePercent: 47, femalePercent: 53, totalCases: 183, recoveredCases: 168, activeCases: 13 }
            },
            tabuk: {
                moh: { worldPercent: 35, saudiPercent: 65, malePercent: 44, femalePercent: 56, totalCases: 40, recoveredCases: 37, activeCases: 3 },
                momra: { worldPercent: 33, saudiPercent: 67, malePercent: 46, femalePercent: 54, totalCases: 28, recoveredCases: 26, activeCases: 2 },
                env: { worldPercent: 30, saudiPercent: 70, malePercent: 48, femalePercent: 52, totalCases: 20, recoveredCases: 18, activeCases: 2 },
                all: { worldPercent: 34, saudiPercent: 66, malePercent: 45, femalePercent: 55, totalCases: 49, recoveredCases: 45, activeCases: 4 }
            },
            buraydah: {
                moh: { worldPercent: 36, saudiPercent: 64, malePercent: 45, femalePercent: 55, totalCases: 95, recoveredCases: 87, activeCases: 7 },
                momra: { worldPercent: 34, saudiPercent: 66, malePercent: 47, femalePercent: 53, totalCases: 67, recoveredCases: 61, activeCases: 5 },
                env: { worldPercent: 31, saudiPercent: 69, malePercent: 49, femalePercent: 51, totalCases: 48, recoveredCases: 44, activeCases: 4 },
                all: { worldPercent: 35, saudiPercent: 65, malePercent: 46, femalePercent: 54, totalCases: 116, recoveredCases: 106, activeCases: 9 }
            },
            hail: {
                moh: { worldPercent: 34, saudiPercent: 66, malePercent: 43, femalePercent: 57, totalCases: 70, recoveredCases: 64, activeCases: 5 },
                momra: { worldPercent: 32, saudiPercent: 68, malePercent: 45, femalePercent: 55, totalCases: 49, recoveredCases: 45, activeCases: 4 },
                env: { worldPercent: 29, saudiPercent: 71, malePercent: 47, femalePercent: 53, totalCases: 35, recoveredCases: 32, activeCases: 3 },
                all: { worldPercent: 33, saudiPercent: 67, malePercent: 44, femalePercent: 56, totalCases: 85, recoveredCases: 78, activeCases: 6 }
            },
            abha: {
                moh: { worldPercent: 35, saudiPercent: 65, malePercent: 44, femalePercent: 56, totalCases: 95, recoveredCases: 87, activeCases: 7 },
                momra: { worldPercent: 33, saudiPercent: 67, malePercent: 46, femalePercent: 54, totalCases: 67, recoveredCases: 61, activeCases: 5 },
                env: { worldPercent: 30, saudiPercent: 70, malePercent: 48, femalePercent: 52, totalCases: 48, recoveredCases: 44, activeCases: 4 },
                all: { worldPercent: 34, saudiPercent: 66, malePercent: 45, femalePercent: 55, totalCases: 116, recoveredCases: 106, activeCases: 9 }
            },
            najran: {
                moh: { worldPercent: 33, saudiPercent: 67, malePercent: 42, femalePercent: 58, totalCases: 55, recoveredCases: 50, activeCases: 4 },
                momra: { worldPercent: 31, saudiPercent: 69, malePercent: 44, femalePercent: 56, totalCases: 39, recoveredCases: 36, activeCases: 3 },
                env: { worldPercent: 28, saudiPercent: 72, malePercent: 46, femalePercent: 54, totalCases: 28, recoveredCases: 26, activeCases: 2 },
                all: { worldPercent: 32, saudiPercent: 68, malePercent: 43, femalePercent: 57, totalCases: 67, recoveredCases: 61, activeCases: 5 }
            },
            jazan: {
                moh: { worldPercent: 34, saudiPercent: 66, malePercent: 43, femalePercent: 57, totalCases: 80, recoveredCases: 73, activeCases: 6 },
                momra: { worldPercent: 32, saudiPercent: 68, malePercent: 45, femalePercent: 55, totalCases: 56, recoveredCases: 51, activeCases: 4 },
                env: { worldPercent: 29, saudiPercent: 71, malePercent: 47, femalePercent: 53, totalCases: 40, recoveredCases: 37, activeCases: 3 },
                all: { worldPercent: 33, saudiPercent: 67, malePercent: 44, femalePercent: 56, totalCases: 97, recoveredCases: 89, activeCases: 7 }
            }
        };

        // Update dashboard with animations based on filters
        function updateDashboard() {
            console.log('updateDashboard() called');
            // Get current filter values
            const city = document.getElementById('citySelect').value;
            const ministry = document.getElementById('ministrySelect').value;
            const week = document.getElementById('weekSelect').value;
            const year = document.getElementById('yearSelect').value;
            console.log('Selected city:', city, 'ministry:', ministry);

            // Update suspected chart title with year and epi-week
            const suspectedChartTitle = document.getElementById('suspectedChartTitle');
            if (suspectedChartTitle) {
                let titleText = 'ØªØµÙ†ÙŠÙ Ø§Ù„Ø­Ø§Ù„Ø©';
                
                // Add year and week information
                if (year && week !== 'all') {
                    titleText += ` - ${year} - Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ ${week}`;
                } else if (year) {
                    titleText += ` - ${year}`;
                } else if (week !== 'all') {
                    titleText += ` - Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ ${week}`;
                }
                
                suspectedChartTitle.textContent = titleText;
            }

            // Get static data based on filters
            const cityData = staticData[city] || staticData['all'];
            const data = cityData[ministry] || cityData['all'];

            // Update statistics with animation (with null checks)
            const totalCasesEl = document.getElementById('totalCases');
            const recoveredCasesEl = document.getElementById('recoveredCases');
            const activeCasesEl = document.getElementById('activeCases');

            const currentTotal = totalCasesEl ? parseInt(totalCasesEl.textContent.replace(/,/g, '')) || 0 : 0;
            const currentRecovered = recoveredCasesEl ? parseInt(recoveredCasesEl.textContent.replace(/,/g, '')) || 0 : 0;
            const currentActive = activeCasesEl ? parseInt(activeCasesEl.textContent.replace(/,/g, '')) || 0 : 0;

            const worldPercentEl = document.getElementById('worldPercent');
            const saudiPercentEl = document.getElementById('saudiPercent');
            const malePercentEl = document.getElementById('malePercent');
            const femalePercentEl = document.getElementById('femalePercent');

            if (worldPercentEl) animateValue('worldPercent', parseInt(worldPercentEl.textContent) || 50, data.worldPercent, 1000, '%');
            if (saudiPercentEl) animateValue('saudiPercent', parseInt(saudiPercentEl.textContent) || 50, data.saudiPercent, 1000, '%');
            if (malePercentEl) animateValue('malePercent', parseInt(malePercentEl.textContent) || 50, data.malePercent, 1000, '%');
            if (femalePercentEl) animateValue('femalePercent', parseInt(femalePercentEl.textContent) || 60, data.femalePercent, 1000, '%');

            // Calculate nationality case counts
            const worldCases = Math.round(data.totalCases * data.worldPercent / 100);
            const saudiCases = Math.round(data.totalCases * data.saudiPercent / 100);

            const worldCasesEl = document.getElementById('worldCases');
            const saudiCasesEl = document.getElementById('saudiCases');
            const currentWorldCases = worldCasesEl ? parseInt(worldCasesEl.textContent.replace(/,/g, '')) || 0 : 0;
            const currentSaudiCases = saudiCasesEl ? parseInt(saudiCasesEl.textContent.replace(/,/g, '')) || 0 : 0;

            // Calculate male and female case counts
            const maleCases = Math.round(data.totalCases * data.malePercent / 100);
            const femaleCases = Math.round(data.totalCases * data.femalePercent / 100);

            const maleCasesEl = document.getElementById('maleCases');
            const femaleCasesEl = document.getElementById('femaleCases');
            const currentMaleCases = maleCasesEl ? parseInt(maleCasesEl.textContent.replace(/,/g, '')) || 0 : 0;
            const currentFemaleCases = femaleCasesEl ? parseInt(femaleCasesEl.textContent.replace(/,/g, '')) || 0 : 0;

            if (totalCasesEl) animateValue('totalCases', currentTotal, data.totalCases, 1000, '');
            if (recoveredCasesEl) animateValue('recoveredCases', currentRecovered, data.recoveredCases, 1000, '');
            if (activeCasesEl) animateValue('activeCases', currentActive, data.activeCases, 1000, '');
            if (worldCasesEl) animateValue('worldCases', currentWorldCases, worldCases, 1000, '');
            if (saudiCasesEl) animateValue('saudiCases', currentSaudiCases, saudiCases, 1000, '');
            if (maleCasesEl) animateValue('maleCases', currentMaleCases, maleCases, 1000, '');
            if (femaleCasesEl) animateValue('femaleCases', currentFemaleCases, femaleCases, 1000, '');

            // Calculate multiplier for charts based on ministry and city
            let dataMultiplier = 1;
            switch(ministry) {
                case 'moh':
                    dataMultiplier = 1.2;
                    break;
                case 'momra':
                    dataMultiplier = 0.7;
                    break;
                case 'env':
                    dataMultiplier = 0.5;
                    break;
                default:
                    dataMultiplier = 1;
            }

            // Adjust multiplier based on city selection (increased ranges for more visible changes)
            const cityMultipliers = {
                'all': 1.0,
                'riyadh': 1.5,
                'jeddah': 1.2,
                'makkah': 0.7,
                'madinah': 0.5,
                'dammam': 0.8,
                'khobar': 0.6,
                'taif': 0.4,
                'tabuk': 0.3,
                'buraydah': 0.35,
                'hail': 0.25,
                'abha': 0.2,
                'najran': 0.15,
                'jazan': 0.2
            };
            
            const cityMultiplier = cityMultipliers[city] || 1.0;
            const finalMultiplier = dataMultiplier * cityMultiplier;

            // Update Activity Chart (line chart)
            if (charts['activity']) {
                console.log('Updating Activity Chart with multiplier:', finalMultiplier);
                charts['activity'].data.datasets.forEach((dataset, index) => {
                    // Update each year with different ranges based on the multiplier
                    if (index === 0) {
                        // 2025
                        dataset.data = generateRandomData(53, Math.floor(15 * finalMultiplier), Math.floor(30 * finalMultiplier));
                    } else if (index === 1) {
                        // 2021
                        dataset.data = generateRandomData(53, Math.floor(8 * finalMultiplier), Math.floor(20 * finalMultiplier));
                    } else if (index === 2) {
                        // 2022
                        dataset.data = generateRandomData(53, Math.floor(10 * finalMultiplier), Math.floor(25 * finalMultiplier));
                    } else if (index === 3) {
                        // 2023
                        dataset.data = generateRandomData(53, Math.floor(12 * finalMultiplier), Math.floor(28 * finalMultiplier));
                    } else if (index === 4) {
                        // 2024
                        dataset.data = generateRandomData(53, Math.floor(8 * finalMultiplier), Math.floor(22 * finalMultiplier));
                    }
                });
                charts['activity'].update('none');  // Use 'none' for immediate update without animation
            } else {
                console.error('Activity chart not found in charts object');
            }

            // Update Suspected vs Confirmed Chart (pie chart)
            if (charts['suspectedChart']) {
                const suspectedValue = Math.floor((45 + Math.random() * 15) * finalMultiplier);
                charts['suspectedChart'].data.datasets[0].data = [suspectedValue, 100 - suspectedValue];
                charts['suspectedChart'].update('active');
            }

            // Update Nationality Chart (horizontal bar chart - 10 bars)
            if (charts['diagnosisChart']) {
                // Generate varying percentages for nationalities that add up to worldPercent
                const basePercentages = [28, 24, 19, 17, 12, 10, 9, 8, 7, 6]; // Egyptian, Yemeni, Pakistani, Indian, Syrian, Bangladeshi, Filipino, Indonesian, Nepali, Sudanese
                const variance = (Math.random() - 0.5) * 10; // -5 to +5 variation
                charts['diagnosisChart'].data.datasets[0].data = basePercentages.map(p => 
                    Math.max(3, Math.min(35, p + variance + (Math.random() - 0.5) * 4))
                );
                charts['diagnosisChart'].update('active');
            }

            // Update Districts with Highest Reporting Rate Chart (horizontal bar chart with numbers - 10 bars)
            if (charts['effectivenessChart']) {
                // Generate varying case numbers for districts
                const baseNumbers = [333, 286, 226, 202, 143, 128, 115, 98, 85, 72];
                const variance = (Math.random() - 0.5) * 40; // -20 to +20 variation
                charts['effectivenessChart'].data.datasets[0].data = baseNumbers.map(n => 
                    Math.max(60, Math.floor(n + variance + (Math.random() - 0.5) * 30))
                );
                charts['effectivenessChart'].update('active');
            }

            // Update Occupations Chart (horizontal bar chart - 10 bars)
            if (charts['ministryChart']) {
                // Generate varying percentages for occupations
                const baseActivities = [28, 22, 18, 16, 16, 14, 12, 11, 10, 9]; // Construction worker, Driver, Cleaner, Security guard, Salesman, Cook, Electrician, Plumber, Farmer, Mechanic
                const variance = (Math.random() - 0.5) * 8; // -4 to +4 variation
                charts['ministryChart'].data.datasets[0].data = baseActivities.map(p => 
                    Math.max(5, Math.min(32, p + variance + (Math.random() - 0.5) * 3))
                );
                charts['ministryChart'].update('active');
            }

            // Update Stacked Hospitals Chart (10 bars)
            if (charts['occupationStackedChart']) {
                // Update each dataset with varying values for 10 hospitals
                const baseConfirmed = [45, 32, 18, 25, 28, 22, 20, 18, 15, 12];
                const baseSuspected = [88, 65, 42, 55, 48, 44, 40, 38, 32, 28];
                const baseUnderInvestigation = [62, 48, 28, 35, 32, 28, 25, 22, 20, 18];
                const baseNotCase = [55, 85, 72, 92, 68, 62, 58, 52, 48, 42];
                
                const variance = (Math.random() - 0.5) * 8;
                
                charts['occupationStackedChart'].data.datasets[0].data = baseConfirmed.map(p => 
                    Math.max(10, Math.min(60, p + variance + (Math.random() - 0.5) * 5))
                );
                charts['occupationStackedChart'].data.datasets[1].data = baseSuspected.map(p => 
                    Math.max(25, Math.min(110, p + variance + (Math.random() - 0.5) * 7))
                );
                charts['occupationStackedChart'].data.datasets[2].data = baseUnderInvestigation.map(p => 
                    Math.max(15, Math.min(80, p + variance + (Math.random() - 0.5) * 6))
                );
                charts['occupationStackedChart'].data.datasets[3].data = baseNotCase.map(p => 
                    Math.max(35, Math.min(115, p + variance + (Math.random() - 0.5) * 8))
                );
                
                charts['occupationStackedChart'].update('active');
            }

            // Update Lab Result Status Chart (10 bars)
            if (charts['occupationStackedChart2']) {
                // Update each dataset with varying values for 10 labs
                const baseCompleted = [45, 32, 18, 25, 28, 24, 22, 20, 18, 15];
                const basePending = [88, 65, 42, 55, 48, 44, 40, 38, 35, 30];
                const baseRejected = [62, 48, 28, 35, 32, 28, 25, 22, 20, 18];
                
                const variance2 = (Math.random() - 0.5) * 8;
                
                charts['occupationStackedChart2'].data.datasets[0].data = baseCompleted.map(p => 
                    Math.max(12, Math.min(60, p + variance2 + (Math.random() - 0.5) * 5))
                );
                charts['occupationStackedChart2'].data.datasets[1].data = basePending.map(p => 
                    Math.max(28, Math.min(110, p + variance2 + (Math.random() - 0.5) * 7))
                );
                charts['occupationStackedChart2'].data.datasets[2].data = baseRejected.map(p => 
                    Math.max(15, Math.min(80, p + variance2 + (Math.random() - 0.5) * 6))
                );
                
                charts['occupationStackedChart2'].update('active');
            }

            // Update Combined Bar and Line Chart for Pending Lab Results (52 epi-weeks)
            if (charts['occupationStackedChart3']) {
                // Update bar datasets (4 test types: IgM, IgG, NS1, PCR) for 52 weeks
                charts['occupationStackedChart3'].data.datasets[0].data = generateRandomData(52, 80, 140);
                charts['occupationStackedChart3'].data.datasets[1].data = generateRandomData(52, 120, 190);
                charts['occupationStackedChart3'].data.datasets[2].data = generateRandomData(52, 25, 65);
                charts['occupationStackedChart3'].data.datasets[3].data = generateRandomData(52, 60, 120);
                
                // Update line data (total)
                charts['occupationStackedChart3'].data.datasets[4].data = generateRandomData(52, 550, 850);
                
                charts['occupationStackedChart3'].update('active');
            }

            // Update TreeMap Chart
            if (charts['treeMapLabsChart']) {
                // Generate new random data for treemap with sub-blocks
                const newTreeMapData = [];
                
                // Viral hemorrhagic fever names (Arabic) - same as initialization
                const viralFeverNames = [
                    'Ø­Ù…Ù‰ Ø§Ù„Ø¶Ù†Ùƒ',           // Dengue
                    'Ø­Ù…Ù‰ Ø§Ù„Ù†ÙŠÙ„ Ø§Ù„ØºØ±Ø¨ÙŠ',    // West Nile fever
                    'Ø­Ù…Ù‰ Ø§Ù„Ø´ÙŠÙƒÙˆÙ†ØºÙˆÙ†ÙŠØ§',    // Chikungunya
                    'Ø­Ù…Ù‰ Ø§Ù„Ø¥ÙŠØ¨ÙˆÙ„Ø§',        // Ebola
                    'Ø­Ù…Ù‰ Ù…Ø§Ø±Ø¨ÙˆØ±Øº',         // Marburg
                    'Ø­Ù…Ù‰ Ù„Ø§Ø³Ø§',            // Lassa fever
                    'Ø­Ù…Ù‰ Ø§Ù„ÙˆØ§Ø¯ÙŠ Ø§Ù„Ù…ØªØµØ¯Ø¹',  // Rift Valley fever
                    'Ø­Ù…Ù‰ Ø§Ù„Ù‚Ø±Ù…-Ø§Ù„ÙƒÙˆÙ†ØºÙˆ',   // Crimean-Congo hemorrhagic fever
                    'Ø­Ù…Ù‰ Ø§Ù„ØµÙØ±Ø§Ø¡'          // Yellow fever
                ];
                
                // Helper function to create sub-blocks with disease names and random values
                function createUpdateSubBlocks(category, blockNum, minVal, maxVal, diseaseNames) {
                    const totalValue = Math.floor(Math.random() * (maxVal - minVal)) + minVal;
                    const subBlockCount = diseaseNames.length;
                    const valuePerSub = totalValue / subBlockCount;
                    diseaseNames.forEach((diseaseName, index) => {
                        newTreeMapData.push({
                            category: category,
                            label: diseaseName,  // Use disease name as the main label
                            parentBlock: `${category}-${blockNum}`,  // Store parent info separately
                            value: valuePerSub
                        });
                    });
                }
                
                // Ø§Ù„Ù…Ø®ØªØ¨Ø± Ø§Ù„Ø§Ù‚Ù„ÙŠÙ…ÙŠ - Blue (7 blocks)
                createUpdateSubBlocks('Ø§Ù„Ù…Ø®ØªØ¨Ø± Ø§Ù„Ø§Ù‚Ù„ÙŠÙ…ÙŠ', 1, 120, 220, [viralFeverNames[0]]);
                createUpdateSubBlocks('Ø§Ù„Ù…Ø®ØªØ¨Ø± Ø§Ù„Ø§Ù‚Ù„ÙŠÙ…ÙŠ', 2, 40, 80, [viralFeverNames[1], viralFeverNames[2]]);
                createUpdateSubBlocks('Ø§Ù„Ù…Ø®ØªØ¨Ø± Ø§Ù„Ø§Ù‚Ù„ÙŠÙ…ÙŠ', 3, 100, 160, [viralFeverNames[3], viralFeverNames[4], viralFeverNames[5]]);
                createUpdateSubBlocks('Ø§Ù„Ù…Ø®ØªØ¨Ø± Ø§Ù„Ø§Ù‚Ù„ÙŠÙ…ÙŠ', 4, 90, 140, [viralFeverNames[6], viralFeverNames[7], viralFeverNames[8], viralFeverNames[0]]);
                createUpdateSubBlocks('Ø§Ù„Ù…Ø®ØªØ¨Ø± Ø§Ù„Ø§Ù‚Ù„ÙŠÙ…ÙŠ', 5, 60, 100, [viralFeverNames[1], viralFeverNames[2], viralFeverNames[3], viralFeverNames[4], viralFeverNames[5]]);
                createUpdateSubBlocks('Ø§Ù„Ù…Ø®ØªØ¨Ø± Ø§Ù„Ø§Ù‚Ù„ÙŠÙ…ÙŠ', 6, 50, 80, [viralFeverNames[6], viralFeverNames[7], viralFeverNames[8], viralFeverNames[0], viralFeverNames[1], viralFeverNames[2]]);
                createUpdateSubBlocks('Ø§Ù„Ù…Ø®ØªØ¨Ø± Ø§Ù„Ø§Ù‚Ù„ÙŠÙ…ÙŠ', 7, 110, 180, [viralFeverNames[3], viralFeverNames[4], viralFeverNames[5], viralFeverNames[6], viralFeverNames[7], viralFeverNames[8], viralFeverNames[0]]);
                
                // Ø§Ù„Ù…Ø®ØªØ¨Ø± Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ - Orange (8 blocks)
                createUpdateSubBlocks('Ø§Ù„Ù…Ø®ØªØ¨Ø± Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ', 1, 50, 80, [viralFeverNames[1]]);
                createUpdateSubBlocks('Ø§Ù„Ù…Ø®ØªØ¨Ø± Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ', 2, 40, 70, [viralFeverNames[2], viralFeverNames[3]]);
                createUpdateSubBlocks('Ø§Ù„Ù…Ø®ØªØ¨Ø± Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ', 3, 35, 60, [viralFeverNames[4], viralFeverNames[5], viralFeverNames[6]]);
                createUpdateSubBlocks('Ø§Ù„Ù…Ø®ØªØ¨Ø± Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ', 4, 100, 160, [viralFeverNames[7], viralFeverNames[8], viralFeverNames[0], viralFeverNames[1]]);
                createUpdateSubBlocks('Ø§Ù„Ù…Ø®ØªØ¨Ø± Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ', 5, 30, 50, [viralFeverNames[2], viralFeverNames[3], viralFeverNames[4], viralFeverNames[5], viralFeverNames[6]]);
                createUpdateSubBlocks('Ø§Ù„Ù…Ø®ØªØ¨Ø± Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ', 6, 45, 75, [viralFeverNames[7], viralFeverNames[8], viralFeverNames[0], viralFeverNames[1], viralFeverNames[2], viralFeverNames[3]]);
                createUpdateSubBlocks('Ø§Ù„Ù…Ø®ØªØ¨Ø± Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ', 7, 70, 110, [viralFeverNames[4], viralFeverNames[5], viralFeverNames[6], viralFeverNames[7], viralFeverNames[8], viralFeverNames[0], viralFeverNames[1]]);
                createUpdateSubBlocks('Ø§Ù„Ù…Ø®ØªØ¨Ø± Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ', 8, 55, 90, [viralFeverNames[2], viralFeverNames[3], viralFeverNames[4], viralFeverNames[5], viralFeverNames[6], viralFeverNames[7], viralFeverNames[8], viralFeverNames[0]]);
                
                // Ù…Ø®ØªØ¨Ø± ÙˆÙ‚Ø§ÙŠØ© - Green (6 blocks)
                createUpdateSubBlocks('Ù…Ø®ØªØ¨Ø± ÙˆÙ‚Ø§ÙŠØ©', 1, 65, 105, [viralFeverNames[1]]);
                createUpdateSubBlocks('Ù…Ø®ØªØ¨Ø± ÙˆÙ‚Ø§ÙŠØ©', 2, 55, 90, [viralFeverNames[2], viralFeverNames[3]]);
                createUpdateSubBlocks('Ù…Ø®ØªØ¨Ø± ÙˆÙ‚Ø§ÙŠØ©', 3, 60, 95, [viralFeverNames[4], viralFeverNames[5], viralFeverNames[6]]);
                createUpdateSubBlocks('Ù…Ø®ØªØ¨Ø± ÙˆÙ‚Ø§ÙŠØ©', 4, 70, 110, [viralFeverNames[7], viralFeverNames[8], viralFeverNames[0], viralFeverNames[1]]);
                createUpdateSubBlocks('Ù…Ø®ØªØ¨Ø± ÙˆÙ‚Ø§ÙŠØ©', 5, 110, 170, [viralFeverNames[2], viralFeverNames[3], viralFeverNames[4], viralFeverNames[5], viralFeverNames[6]]);
                createUpdateSubBlocks('Ù…Ø®ØªØ¨Ø± ÙˆÙ‚Ø§ÙŠØ©', 6, 130, 200, [viralFeverNames[7], viralFeverNames[8], viralFeverNames[0], viralFeverNames[1], viralFeverNames[2], viralFeverNames[3]]);
                
                // Ù…Ø®ØªØ¨Ø± Ø¨Ù†Ùƒ Ø§Ù„Ø¯Ù… - Teal (8 blocks)
                createUpdateSubBlocks('Ù…Ø®ØªØ¨Ø± Ø¨Ù†Ùƒ Ø§Ù„Ø¯Ù…', 1, 75, 120, [viralFeverNames[4]]);
                createUpdateSubBlocks('Ù…Ø®ØªØ¨Ø± Ø¨Ù†Ùƒ Ø§Ù„Ø¯Ù…', 2, 85, 135, [viralFeverNames[5], viralFeverNames[6]]);
                createUpdateSubBlocks('Ù…Ø®ØªØ¨Ø± Ø¨Ù†Ùƒ Ø§Ù„Ø¯Ù…', 3, 60, 100, [viralFeverNames[7], viralFeverNames[8], viralFeverNames[0]]);
                createUpdateSubBlocks('Ù…Ø®ØªØ¨Ø± Ø¨Ù†Ùƒ Ø§Ù„Ø¯Ù…', 4, 100, 160, [viralFeverNames[1], viralFeverNames[2], viralFeverNames[3], viralFeverNames[4]]);
                createUpdateSubBlocks('Ù…Ø®ØªØ¨Ø± Ø¨Ù†Ùƒ Ø§Ù„Ø¯Ù…', 5, 65, 105, [viralFeverNames[5], viralFeverNames[6], viralFeverNames[7], viralFeverNames[8], viralFeverNames[0]]);
                createUpdateSubBlocks('Ù…Ø®ØªØ¨Ø± Ø¨Ù†Ùƒ Ø§Ù„Ø¯Ù…', 6, 70, 115, [viralFeverNames[1], viralFeverNames[2], viralFeverNames[3], viralFeverNames[4], viralFeverNames[5], viralFeverNames[6]]);
                createUpdateSubBlocks('Ù…Ø®ØªØ¨Ø± Ø¨Ù†Ùƒ Ø§Ù„Ø¯Ù…', 7, 130, 210, [viralFeverNames[7], viralFeverNames[8], viralFeverNames[0], viralFeverNames[1], viralFeverNames[2], viralFeverNames[3], viralFeverNames[4]]);
                createUpdateSubBlocks('Ù…Ø®ØªØ¨Ø± Ø¨Ù†Ùƒ Ø§Ù„Ø¯Ù…', 8, 75, 125, [viralFeverNames[5], viralFeverNames[6], viralFeverNames[7], viralFeverNames[8], viralFeverNames[0], viralFeverNames[1], viralFeverNames[2], viralFeverNames[3]]);
                
                charts['treeMapLabsChart'].data.datasets[0].tree = newTreeMapData;
                charts['treeMapLabsChart'].update('active');
            }

            // Update Age Group Chart (topRegionsChart)
            if (charts['topRegionsChart']) {
                // Base data for age groups (reversed: oldest to youngest)
                const baseAgeData = [68, 98, 142, 185, 220, 265, 298, 312, 245, 189, 125, 78, 45];
                const variance = (Math.random() - 0.5) * 15; // -7.5 to +7.5 variation

                charts['topRegionsChart'].data.datasets[0].data = baseAgeData.map(value =>
                    Math.max(10, Math.floor(value * finalMultiplier + variance + (Math.random() - 0.5) * 10))
                );
                charts['topRegionsChart'].update('active');
            }

            // Update Pie Charts at the bottom
            if (charts['pieChart1']) {
                const pieValue1 = Math.floor((45 + Math.random() * 15) * finalMultiplier);
                charts['pieChart1'].data.datasets[0].data = [pieValue1, 100 - pieValue1];
                charts['pieChart1'].update('active');
            }

            if (charts['pieChart2']) {
                const pieValue2 = Math.floor((40 + Math.random() * 20) * finalMultiplier);
                charts['pieChart2'].data.datasets[0].data = [pieValue2, 100 - pieValue2];
                charts['pieChart2'].update('active');
            }

            if (charts['pieChart3']) {
                const pieValue3 = Math.floor((50 + Math.random() * 15) * finalMultiplier);
                charts['pieChart3'].data.datasets[0].data = [pieValue3, 100 - pieValue3];
                charts['pieChart3'].update('active');
            }

            if (charts['pieChart4']) {
                const pieValue4 = Math.floor((55 + Math.random() * 15) * finalMultiplier);
                charts['pieChart4'].data.datasets[0].data = [pieValue4, 100 - pieValue4];
                charts['pieChart4'].update('active');
            }
        }

        // Static city data - no need to update dynamically
        // City cases are fixed in the map generation (lines 997-1006)

        // Animate number changes
        function animateValue(id, start, end, duration, suffix = '') {
            const element = document.getElementById(id);
            if (!element) return;
            
            const range = end - start;
            const increment = range / (duration / 16);
            let current = start;
            
            const timer = setInterval(() => {
                current += increment;
                if ((increment > 0 && current >= end) || (increment < 0 && current <= end)) {
                    current = end;
                    clearInterval(timer);
                }
                // Use en-US locale to keep numbers in English format with comma separators
                element.textContent = Math.round(current).toLocaleString('en-US') + suffix;
            }, 16);
        }

        // Apply filters
        function applyFilters() {
            const filters = {
                city: document.getElementById('citySelect').value,
                year: document.getElementById('yearSelect').value,
                week: document.getElementById('weekSelect').value,
                caseType: document.getElementById('caseTypeSelect').value,
                outcome: document.getElementById('outcomeSelect').value,
                gender: document.getElementById('genderSelect').value,
                nationality: document.getElementById('nationalitySelect').value,
                ageGroup: document.getElementById('ageGroupSelect').value,
                ministry: document.getElementById('ministrySelect').value
            };
            
            console.log('Filters applied:', filters);
            updateDashboard();
        }

        // Show notification
        function showNotification(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.style.display = 'block';
            setTimeout(() => {
                toast.style.display = 'none';
            }, 3000);
        }

        // Initialize everything
        window.addEventListener('DOMContentLoaded', () => {
            // Load GeoJSON first, then generate map
            loadGeoJSON();
            
            createActivityChart();
            
            // Create horizontal bar chart for age groups
            createHorizontalBarChart('topRegionsChart', 
                ['60+', '56-60', '51-55', '46-50', '41-45', '36-40', '31-35', '26-30', '21-25', '16-20', '11-15', '6-10', '0-5'], 
                [{ 
                    data: [68, 98, 142, 185, 220, 265, 298, 312, 245, 189, 125, 78, 45], 
                    backgroundColor: ['#0a7c6b', '#0c9ca5', '#0cc59c', '#4ecdc4', '#5dd9c1', '#0a7c6b', '#0c9ca5', '#0cc59c', '#4ecdc4', '#5dd9c1', '#0a7c6b', '#0c9ca5', '#0cc59c'],
                    barThickness: 28
                }]
            );
            
            createDonutChart('suspectedChart', 'Ø§Ù„Ù…Ø´ØªØ¨Ù‡Ø©', 'Ø§Ù„Ù…Ø¤ÙƒØ¯', '#0cc59c', '#0c9ca5');
            
            // Create horizontal bar chart for non-Saudi nationalities (10 bars)
            createHorizontalBarChart('diagnosisChart', ['Ù…ØµØ±ÙŠ', 'ÙŠÙ…Ù†ÙŠ', 'Ø¨Ø§ÙƒØ³ØªØ§Ù†ÙŠ', 'Ù‡Ù†Ø¯ÙŠ', 'Ø³ÙˆØ±ÙŠ', 'Ø¨Ù†ØºØ§Ù„ÙŠ', 'ÙÙ„Ø¨ÙŠÙ†ÙŠ', 'Ø¥Ù†Ø¯ÙˆÙ†ÙŠØ³ÙŠ', 'Ù†ÙŠØ¨Ø§Ù„ÙŠ', 'Ø³ÙˆØ¯Ø§Ù†ÙŠ'], [
                { 
                    data: [28, 24, 19, 17, 12, 10, 9, 8, 7, 6], 
                    backgroundColor: ['#0cc59c', '#0c9ca5', '#0a7c6b', '#4ecdc4', '#5dd9c1', '#0cc59c', '#0c9ca5', '#0a7c6b', '#4ecdc4', '#5dd9c1'],
                    barThickness: 20
                }
            ]);
            
            // Initialize suspected chart title based on current year and week selection
            const initialWeek = document.getElementById('weekSelect').value;
            const initialYear = document.getElementById('yearSelect').value;
            const suspectedChartTitle = document.getElementById('suspectedChartTitle');
            if (suspectedChartTitle) {
                let titleText = 'ØªØµÙ†ÙŠÙ Ø§Ù„Ø­Ø§Ù„Ø©';
                
                if (initialYear && initialWeek !== 'all') {
                    titleText += ` - ${initialYear} - Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ ${initialWeek}`;
                } else if (initialYear) {
                    titleText += ` - ${initialYear}`;
                } else if (initialWeek !== 'all') {
                    titleText += ` - Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ ${initialWeek}`;
                }
                
                suspectedChartTitle.textContent = titleText;
            }
            
            // Create horizontal bar chart for occupations (10 bars)
            createHorizontalBarChart('ministryChart', ['Ø¹Ø§Ù…Ù„ Ø¨Ù†Ø§Ø¡', 'Ø³Ø§Ø¦Ù‚', 'Ø¹Ø§Ù…Ù„ Ù†Ø¸Ø§ÙØ©', 'Ø­Ø§Ø±Ø³ Ø£Ù…Ù†', 'Ø¨Ø§Ø¦Ø¹', 'Ø·Ø¨Ø§Ø®', 'ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠ', 'Ø³Ø¨Ø§Ùƒ', 'Ù…Ø²Ø§Ø±Ø¹', 'Ù…ÙŠÙƒØ§Ù†ÙŠÙƒÙŠ'], [
                { 
                    data: [28, 22, 18, 16, 16, 14, 12, 11, 10, 9], 
                    backgroundColor: ['#0cc59c', '#0c9ca5', '#0a7c6b', '#4ecdc4', '#5dd9c1', '#0cc59c', '#0c9ca5', '#0a7c6b', '#4ecdc4', '#5dd9c1'],
                    barThickness: 20
                }
            ]);
            
            // Create stacked horizontal bar chart for most reporting hospitals (10 bars)
            createStackedHorizontalBarChart('occupationStackedChart', ['Ù…Ø³ØªØ´ÙÙ‰ Ø§Ù„Ù…Ù„Ùƒ ÙÙŠØµÙ„ Ø§Ù„ØªØ®ØµØµÙŠ', 'Ù…Ø³ØªØ´ÙÙ‰ Ø§Ù„Ù…Ù„Ùƒ ÙÙ‡Ø¯ Ø§Ù„ØªØ®ØµØµÙŠ', 'Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ù…Ù„Ùƒ Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø§Ù„Ø·Ø¨ÙŠØ©', 'Ù…Ø³ØªØ´ÙÙ‰ Ø§Ù„Ø¥ÙŠÙ…Ø§Ù† Ø§Ù„Ø¹Ø§Ù…', 'Ù…Ø³ØªØ´ÙÙ‰ Ø§Ù„Ù…Ù„Ùƒ Ø®Ø§Ù„Ø¯ Ø§Ù„Ø¬Ø§Ù…Ø¹ÙŠ', 'Ù…Ø³ØªØ´ÙÙ‰ Ø§Ù„Ù…Ù„Ùƒ Ø¹Ø¨Ø¯Ø§Ù„Ø¹Ø²ÙŠØ²', 'Ù…Ø³ØªØ´ÙÙ‰ Ø§Ù„Ù‚ÙˆØ§Øª Ø§Ù„Ù…Ø³Ù„Ø­Ø©', 'Ù…Ø³ØªØ´ÙÙ‰ Ø§Ù„Ø­Ø±Ø³ Ø§Ù„ÙˆØ·Ù†ÙŠ', 'Ù…Ø³ØªØ´ÙÙ‰ Ø§Ù„Ø£Ù…ÙŠØ± Ø³Ù„Ø·Ø§Ù†', 'Ù…Ø³ØªØ´ÙÙ‰ Ø§Ù„Ù…Ø±ÙƒØ² Ø§Ù„Ø·Ø¨ÙŠ Ø§Ù„Ø¯ÙˆÙ„ÙŠ'], [
                {
                    label: 'Ù…Ø¤ÙƒØ¯',
                    data: [45, 32, 18, 25, 28, 22, 20, 18, 15, 12],
                    backgroundColor: '#0cc59c',
                    barThickness: 22
                },
                {
                    label: 'Ù…Ø´ØªØ¨Ù‡Ø©',
                    data: [88, 65, 42, 55, 48, 44, 40, 38, 32, 28],
                    backgroundColor: '#0c9ca5',
                    barThickness: 22
                },
                {
                    label: 'ØªØ­Øª Ø§Ù„ØªÙ‚ØµÙŠ',
                    data: [62, 48, 28, 35, 32, 28, 25, 22, 20, 18],
                    backgroundColor: '#4ecdc4',
                    barThickness: 22
                },
                {
                    label: 'Ù„ÙŠØ³Øª Ø­Ø§Ù„Ø©',
                    data: [55, 85, 72, 92, 68, 62, 58, 52, 48, 42],
                    backgroundColor: '#5dd9c1',
                    barThickness: 22
                }
            ]);
            
            // Create stacked horizontal bar chart for lab result status (10 bars)
            createStackedHorizontalBarChart('occupationStackedChart2', ['Ø§Ù„Ù…Ø®ØªØ¨Ø± Ø§Ù„Ø§Ù‚Ù„ÙŠÙ…ÙŠ', 'Ø§Ù„Ù…Ø®ØªØ¨Ø± Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ', 'Ù…Ø®ØªØ¨Ø± ÙˆÙ‚Ø§ÙŠØ©', 'Ù…Ø®ØªØ¨Ø± Ø¨Ù†Ùƒ Ø§Ù„Ø¯Ù…', 'Ù…Ø®ØªØ¨Ø± Ø§Ù„Ù…Ø³ØªØ´ÙÙ‰ Ø§Ù„ØªØ®ØµØµÙŠ', 'Ù…Ø®ØªØ¨Ø± Ø§Ù„ØµØ­Ø© Ø§Ù„Ø¹Ø§Ù…Ø©', 'Ù…Ø®ØªØ¨Ø± Ø§Ù„Ù‚ÙˆØ§Øª Ø§Ù„Ù…Ø³Ù„Ø­Ø©', 'Ù…Ø®ØªØ¨Ø± Ø§Ù„Ø­Ø±Ø³ Ø§Ù„ÙˆØ·Ù†ÙŠ', 'Ù…Ø®ØªØ¨Ø± Ø§Ù„Ø¬Ø§Ù…Ø¹Ø©', 'Ù…Ø®ØªØ¨Ø± Ø§Ù„Ù‚Ø·Ø§Ø¹ Ø§Ù„Ø®Ø§Øµ'], [
                {
                    label: 'Ù…ÙƒØªÙ…Ù„',
                    data: [45, 32, 18, 25, 28, 24, 22, 20, 18, 15],
                    backgroundColor: '#0cc59c',
                    barThickness: 22
                },
                {
                    label: 'Ù…Ø¹Ù„Ù‚',
                    data: [88, 65, 42, 55, 48, 44, 40, 38, 35, 30],
                    backgroundColor: '#0c9ca5',
                    barThickness: 22
                },
                {
                    label: 'Ù…Ø±ÙÙˆØ¶',
                    data: [62, 48, 28, 35, 32, 28, 25, 22, 20, 18],
                    backgroundColor: '#4ecdc4',
                    barThickness: 22
                }
            ]);
            
            // Create combined bar and line chart for pending lab results with 52 epi-weeks
            const epiWeeks = Array.from({length: 52}, (_, i) => (i + 1).toString());
            createCombinedBarLineChart('occupationStackedChart3', 
                epiWeeks, 
                [
                    {
                        label: 'IgM',
                        data: generateRandomData(52, 80, 140),
                        backgroundColor: '#0cc59c',
                        barThickness: 6
                    },
                    {
                        label: 'IgG',
                        data: generateRandomData(52, 120, 190),
                        backgroundColor: '#0c9ca5',
                        barThickness: 6
                    },
                    {
                        label: 'NS1',
                        data: generateRandomData(52, 25, 65),
                        backgroundColor: '#4ecdc4',
                        barThickness: 6
                    },
                    {
                        label: 'PCR',
                        data: generateRandomData(52, 60, 120),
                        backgroundColor: '#5dd9c1',
                        barThickness: 6
                    }
                ],
                generateRandomData(52, 550, 850)
            );
            
            // Create TreeMap chart for lab categories
            // Each block is divided into sub-blocks named after viral hemorrhagic fevers
            const treeMapData = [];
            
            // Viral hemorrhagic fever names (Arabic)
            const viralFeverNames = [
                'Ø­Ù…Ù‰ Ø§Ù„Ø¶Ù†Ùƒ',           // Dengue
                'Ø­Ù…Ù‰ Ø§Ù„Ù†ÙŠÙ„ Ø§Ù„ØºØ±Ø¨ÙŠ',    // West Nile fever
                'Ø­Ù…Ù‰ Ø§Ù„Ø´ÙŠÙƒÙˆÙ†ØºÙˆÙ†ÙŠØ§',    // Chikungunya
                'Ø­Ù…Ù‰ Ø§Ù„Ø¥ÙŠØ¨ÙˆÙ„Ø§',        // Ebola
                'Ø­Ù…Ù‰ Ù…Ø§Ø±Ø¨ÙˆØ±Øº',         // Marburg
                'Ø­Ù…Ù‰ Ù„Ø§Ø³Ø§',            // Lassa fever
                'Ø­Ù…Ù‰ Ø§Ù„ÙˆØ§Ø¯ÙŠ Ø§Ù„Ù…ØªØµØ¯Ø¹',  // Rift Valley fever
                'Ø­Ù…Ù‰ Ø§Ù„Ù‚Ø±Ù…-Ø§Ù„ÙƒÙˆÙ†ØºÙˆ',   // Crimean-Congo hemorrhagic fever
                'Ø­Ù…Ù‰ Ø§Ù„ØµÙØ±Ø§Ø¡'          // Yellow fever
            ];
            
            // Helper function to create sub-blocks with disease names
            function createSubBlocks(category, blockNum, totalValue, diseaseNames) {
                const subBlockCount = diseaseNames.length;
                const valuePerSub = totalValue / subBlockCount;
                diseaseNames.forEach((diseaseName, index) => {
                    treeMapData.push({
                        category: category,
                        label: diseaseName,  // Use disease name as the main label
                        parentBlock: `${category}-${blockNum}`,  // Store parent info separately
                        value: valuePerSub
                    });
                });
            }
            
            // Ø§Ù„Ù…Ø®ØªØ¨Ø± Ø§Ù„Ø§Ù‚Ù„ÙŠÙ…ÙŠ - Blue (7 blocks)
            createSubBlocks('Ø§Ù„Ù…Ø®ØªØ¨Ø± Ø§Ù„Ø§Ù‚Ù„ÙŠÙ…ÙŠ', 1, 180, [viralFeverNames[0]]);
            createSubBlocks('Ø§Ù„Ù…Ø®ØªØ¨Ø± Ø§Ù„Ø§Ù‚Ù„ÙŠÙ…ÙŠ', 2, 60, [viralFeverNames[1], viralFeverNames[2]]);
            createSubBlocks('Ø§Ù„Ù…Ø®ØªØ¨Ø± Ø§Ù„Ø§Ù‚Ù„ÙŠÙ…ÙŠ', 3, 140, [viralFeverNames[3], viralFeverNames[4], viralFeverNames[5]]);
            createSubBlocks('Ø§Ù„Ù…Ø®ØªØ¨Ø± Ø§Ù„Ø§Ù‚Ù„ÙŠÙ…ÙŠ', 4, 120, [viralFeverNames[6], viralFeverNames[7], viralFeverNames[8], viralFeverNames[0]]);
            createSubBlocks('Ø§Ù„Ù…Ø®ØªØ¨Ø± Ø§Ù„Ø§Ù‚Ù„ÙŠÙ…ÙŠ', 5, 80, [viralFeverNames[1], viralFeverNames[2], viralFeverNames[3], viralFeverNames[4], viralFeverNames[5]]);
            createSubBlocks('Ø§Ù„Ù…Ø®ØªØ¨Ø± Ø§Ù„Ø§Ù‚Ù„ÙŠÙ…ÙŠ', 6, 70, [viralFeverNames[6], viralFeverNames[7], viralFeverNames[8], viralFeverNames[0], viralFeverNames[1], viralFeverNames[2]]);
            createSubBlocks('Ø§Ù„Ù…Ø®ØªØ¨Ø± Ø§Ù„Ø§Ù‚Ù„ÙŠÙ…ÙŠ', 7, 150, [viralFeverNames[3], viralFeverNames[4], viralFeverNames[5], viralFeverNames[6], viralFeverNames[7], viralFeverNames[8], viralFeverNames[0]]);
            
            // Ø§Ù„Ù…Ø®ØªØ¨Ø± Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ - Orange (8 blocks)
            createSubBlocks('Ø§Ù„Ù…Ø®ØªØ¨Ø± Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ', 1, 65, [viralFeverNames[1]]);
            createSubBlocks('Ø§Ù„Ù…Ø®ØªØ¨Ø± Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ', 2, 55, [viralFeverNames[2], viralFeverNames[3]]);
            createSubBlocks('Ø§Ù„Ù…Ø®ØªØ¨Ø± Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ', 3, 45, [viralFeverNames[4], viralFeverNames[5], viralFeverNames[6]]);
            createSubBlocks('Ø§Ù„Ù…Ø®ØªØ¨Ø± Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ', 4, 130, [viralFeverNames[7], viralFeverNames[8], viralFeverNames[0], viralFeverNames[1]]);
            createSubBlocks('Ø§Ù„Ù…Ø®ØªØ¨Ø± Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ', 5, 40, [viralFeverNames[2], viralFeverNames[3], viralFeverNames[4], viralFeverNames[5], viralFeverNames[6]]);
            createSubBlocks('Ø§Ù„Ù…Ø®ØªØ¨Ø± Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ', 6, 60, [viralFeverNames[7], viralFeverNames[8], viralFeverNames[0], viralFeverNames[1], viralFeverNames[2], viralFeverNames[3]]);
            createSubBlocks('Ø§Ù„Ù…Ø®ØªØ¨Ø± Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ', 7, 90, [viralFeverNames[4], viralFeverNames[5], viralFeverNames[6], viralFeverNames[7], viralFeverNames[8], viralFeverNames[0], viralFeverNames[1]]);
            createSubBlocks('Ø§Ù„Ù…Ø®ØªØ¨Ø± Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ', 8, 75, [viralFeverNames[2], viralFeverNames[3], viralFeverNames[4], viralFeverNames[5], viralFeverNames[6], viralFeverNames[7], viralFeverNames[8], viralFeverNames[0]]);
            
            // Ù…Ø®ØªØ¨Ø± ÙˆÙ‚Ø§ÙŠØ© - Green (6 blocks)
            createSubBlocks('Ù…Ø®ØªØ¨Ø± ÙˆÙ‚Ø§ÙŠØ©', 1, 85, [viralFeverNames[1]]);
            createSubBlocks('Ù…Ø®ØªØ¨Ø± ÙˆÙ‚Ø§ÙŠØ©', 2, 70, [viralFeverNames[2], viralFeverNames[3]]);
            createSubBlocks('Ù…Ø®ØªØ¨Ø± ÙˆÙ‚Ø§ÙŠØ©', 3, 75, [viralFeverNames[4], viralFeverNames[5], viralFeverNames[6]]);
            createSubBlocks('Ù…Ø®ØªØ¨Ø± ÙˆÙ‚Ø§ÙŠØ©', 4, 90, [viralFeverNames[7], viralFeverNames[8], viralFeverNames[0], viralFeverNames[1]]);
            createSubBlocks('Ù…Ø®ØªØ¨Ø± ÙˆÙ‚Ø§ÙŠØ©', 5, 140, [viralFeverNames[2], viralFeverNames[3], viralFeverNames[4], viralFeverNames[5], viralFeverNames[6]]);
            createSubBlocks('Ù…Ø®ØªØ¨Ø± ÙˆÙ‚Ø§ÙŠØ©', 6, 160, [viralFeverNames[7], viralFeverNames[8], viralFeverNames[0], viralFeverNames[1], viralFeverNames[2], viralFeverNames[3]]);
            
            // Ù…Ø®ØªØ¨Ø± Ø¨Ù†Ùƒ Ø§Ù„Ø¯Ù… - Teal (8 blocks)
            createSubBlocks('Ù…Ø®ØªØ¨Ø± Ø¨Ù†Ùƒ Ø§Ù„Ø¯Ù…', 1, 95, [viralFeverNames[4]]);
            createSubBlocks('Ù…Ø®ØªØ¨Ø± Ø¨Ù†Ùƒ Ø§Ù„Ø¯Ù…', 2, 110, [viralFeverNames[5], viralFeverNames[6]]);
            createSubBlocks('Ù…Ø®ØªØ¨Ø± Ø¨Ù†Ùƒ Ø§Ù„Ø¯Ù…', 3, 80, [viralFeverNames[7], viralFeverNames[8], viralFeverNames[0]]);
            createSubBlocks('Ù…Ø®ØªØ¨Ø± Ø¨Ù†Ùƒ Ø§Ù„Ø¯Ù…', 4, 130, [viralFeverNames[1], viralFeverNames[2], viralFeverNames[3], viralFeverNames[4]]);
            createSubBlocks('Ù…Ø®ØªØ¨Ø± Ø¨Ù†Ùƒ Ø§Ù„Ø¯Ù…', 5, 85, [viralFeverNames[5], viralFeverNames[6], viralFeverNames[7], viralFeverNames[8], viralFeverNames[0]]);
            createSubBlocks('Ù…Ø®ØªØ¨Ø± Ø¨Ù†Ùƒ Ø§Ù„Ø¯Ù…', 6, 90, [viralFeverNames[1], viralFeverNames[2], viralFeverNames[3], viralFeverNames[4], viralFeverNames[5], viralFeverNames[6]]);
            createSubBlocks('Ù…Ø®ØªØ¨Ø± Ø¨Ù†Ùƒ Ø§Ù„Ø¯Ù…', 7, 170, [viralFeverNames[7], viralFeverNames[8], viralFeverNames[0], viralFeverNames[1], viralFeverNames[2], viralFeverNames[3], viralFeverNames[4]]);
            createSubBlocks('Ù…Ø®ØªØ¨Ø± Ø¨Ù†Ùƒ Ø§Ù„Ø¯Ù…', 8, 100, [viralFeverNames[5], viralFeverNames[6], viralFeverNames[7], viralFeverNames[8], viralFeverNames[0], viralFeverNames[1], viralFeverNames[2], viralFeverNames[3]]);
            
            // Ù…Ø®ØªØ¨Ø± Ø§Ù„Ù…ÙŠÙƒØ±ÙˆØ¨ÙŠÙˆÙ„ÙˆØ¬ÙŠØ§ - Purple (6 blocks)
            createSubBlocks('Ù…Ø®ØªØ¨Ø± Ø§Ù„Ù…ÙŠÙƒØ±ÙˆØ¨ÙŠÙˆÙ„ÙˆØ¬ÙŠØ§', 1, 75, [viralFeverNames[0]]);
            createSubBlocks('Ù…Ø®ØªØ¨Ø± Ø§Ù„Ù…ÙŠÙƒØ±ÙˆØ¨ÙŠÙˆÙ„ÙˆØ¬ÙŠØ§', 2, 65, [viralFeverNames[1], viralFeverNames[2]]);
            createSubBlocks('Ù…Ø®ØªØ¨Ø± Ø§Ù„Ù…ÙŠÙƒØ±ÙˆØ¨ÙŠÙˆÙ„ÙˆØ¬ÙŠØ§', 3, 95, [viralFeverNames[3], viralFeverNames[4], viralFeverNames[5]]);
            createSubBlocks('Ù…Ø®ØªØ¨Ø± Ø§Ù„Ù…ÙŠÙƒØ±ÙˆØ¨ÙŠÙˆÙ„ÙˆØ¬ÙŠØ§', 4, 120, [viralFeverNames[6], viralFeverNames[7], viralFeverNames[8], viralFeverNames[0]]);
            createSubBlocks('Ù…Ø®ØªØ¨Ø± Ø§Ù„Ù…ÙŠÙƒØ±ÙˆØ¨ÙŠÙˆÙ„ÙˆØ¬ÙŠØ§', 5, 110, [viralFeverNames[1], viralFeverNames[2], viralFeverNames[3], viralFeverNames[4], viralFeverNames[5]]);
            createSubBlocks('Ù…Ø®ØªØ¨Ø± Ø§Ù„Ù…ÙŠÙƒØ±ÙˆØ¨ÙŠÙˆÙ„ÙˆØ¬ÙŠØ§', 6, 85, [viralFeverNames[6], viralFeverNames[7], viralFeverNames[8], viralFeverNames[0], viralFeverNames[1], viralFeverNames[2]]);
            
            createTreeMapChart('treeMapLabsChart', treeMapData);
            
            // Create horizontal bar chart for districts with highest reporting rate
            // Display actual numbers on x-axis with percentages shown next to bars
            const districtsCtx = document.getElementById('effectivenessChart').getContext('2d');
            
            // Plugin to display percentages above bars
            const percentagePlugin = {
                id: 'percentagePlugin',
                afterDatasetsDraw(chart) {
                    const { ctx, data, scales: { x, y } } = chart;
                    ctx.save();
                    ctx.font = 'bold 14px Arial';
                    ctx.fillStyle = '#0a7c6b';
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'bottom';
                    
                    data.datasets.forEach((dataset, datasetIndex) => {
                        chart.getDatasetMeta(datasetIndex).data.forEach((bar, index) => {
                            const value = dataset.data[index];
                            const totalValue = dataset.totalValues ? dataset.totalValues[index] : 1000;
                            const percentage = Math.round((value / totalValue) * 100);
                            
                            const xPos = bar.x;
                            const yPos = bar.y - 5;
                            
                            ctx.fillText(percentage + '%', xPos, yPos);
                        });
                    });
                    ctx.restore();
                }
            };
            
            charts['effectivenessChart'] = new Chart(districtsCtx, {
                type: 'bar',
                data: {
                    labels: ['Ø­ÙŠ Ø§Ù„ÙÙŠØµÙ„ÙŠØ©', 'Ø­ÙŠ Ù…Ù†ÙÙˆØ­Ø©', 'Ø­ÙŠ Ø§Ù„Ø±Ø­Ø§Ø¨', 'Ø­ÙŠ Ø§Ù„ØµÙØ§', 'Ø­ÙŠ Ø§Ù„Ø«ØºØ±', 'Ø­ÙŠ Ø§Ù„Ù†Ø³ÙŠÙ…', 'Ø­ÙŠ Ø§Ù„Ø¹Ù„ÙŠØ§', 'Ø­ÙŠ Ø§Ù„Ù…Ù„Ø²', 'Ø­ÙŠ Ø§Ù„Ù…Ø±ÙˆØ¬', 'Ø­ÙŠ Ø§Ù„ÙŠØ§Ø³Ù…ÙŠÙ†'],
                    datasets: [{
                        data: [333, 286, 226, 202, 143, 128, 115, 98, 85, 72],
                        totalValues: [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000], // For percentage calculation
                        backgroundColor: ['#0cc59c', '#0c9ca5', '#0a7c6b', '#4ecdc4', '#5dd9c1', '#0cc59c', '#0c9ca5', '#0a7c6b', '#4ecdc4', '#5dd9c1'],
                        barThickness: 22
                    }]
                },
                options: {
                    indexAxis: 'x',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            backgroundColor: 'rgba(10, 124, 107, 0.95)',
                            padding: 12,
                            callbacks: {
                                label: function(context) {
                                    const value = context.parsed.y;
                                    const totalValue = context.dataset.totalValues ? context.dataset.totalValues[context.dataIndex] : 1000;
                                    const percentage = Math.round((value / totalValue) * 100);
                                    return value + ' (' + percentage + '%)';
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: { display: false },
                            ticks: { 
                                font: { 
                                    size: 14,
                                    weight: 'bold'
                                },
                                maxRotation: 45,
                                minRotation: 45
                            }
                        },
                        y: {
                            beginAtZero: true,
                            max: 400,
                            grid: { color: 'rgba(12, 197, 156, 0.2)' },
                            ticks: {
                                font: { size: 11 },
                                callback: function(value) {
                                    return value; // Show plain numbers
                                }
                            }
                        }
                    }
                },
                plugins: [percentagePlugin]
            });

            // Create 4 pie charts at the bottom
            createPieChart('pieChart1', 'ØªÙ… Ø§Ù„ØªÙ†Ø³ÙŠÙ‚', 'Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªÙ†Ø³ÙŠÙ‚', '#0cc59c', '#0c9ca5');
            createPieChart('pieChart2', 'ØªÙ… Ø§Ù„ØªÙ‚ØµÙŠ', 'Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªÙ‚ØµÙŠ', '#0a7c6b', '#4ecdc4');
            createPieChart('pieChart3', 'ØªÙ… Ø§Ù„ØªØ«Ù‚ÙŠÙ', 'Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªØ«Ù‚ÙŠÙ', '#5dd9c1', '#3498db');
            createPieChart('pieChart4', 'ØªÙ… Ø§Ù„ØªØ«Ù‚ÙŠÙ', 'Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªØ«Ù‚ÙŠÙ', '#f38181', '#4ecdc4');

            // Initialize statistics with default values
            document.getElementById('worldPercent').textContent = '45%';
            document.getElementById('saudiPercent').textContent = '55%';
            document.getElementById('malePercent').textContent = '48%';
            document.getElementById('femalePercent').textContent = '52%';
            document.getElementById('totalCases').textContent = '2,645';
            document.getElementById('recoveredCases').textContent = '2,423';
            document.getElementById('deathCases').textContent = '55';
            document.getElementById('wardCases').textContent = '98';
            document.getElementById('icuCases').textContent = '34';
        });
    </script>
</body>
</html>
